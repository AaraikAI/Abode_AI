"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/[...nextauth]/route";
exports.ids = ["app/api/auth/[...nextauth]/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "async_hooks":
/*!******************************!*\
  !*** external "async_hooks" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("async_hooks");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2FUsers%2Fgverma%2FDesktop%2FAARAIK%20LLC%2FAbode_AI%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgverma%2FDesktop%2FAARAIK%20LLC%2FAbode_AI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2FUsers%2Fgverma%2FDesktop%2FAARAIK%20LLC%2FAbode_AI%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgverma%2FDesktop%2FAARAIK%20LLC%2FAbode_AI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_gverma_Desktop_AARAIK_LLC_Abode_AI_app_api_auth_nextauth_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/auth/[...nextauth]/route.ts */ \"(rsc)/./app/api/auth/[...nextauth]/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/[...nextauth]/route\",\n        pathname: \"/api/auth/[...nextauth]\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/[...nextauth]/route\"\n    },\n    resolvedPagePath: \"/Users/gverma/Desktop/AARAIK LLC/Abode_AI/app/api/auth/[...nextauth]/route.ts\",\n    nextConfigOutput,\n    userland: _Users_gverma_Desktop_AARAIK_LLC_Abode_AI_app_api_auth_nextauth_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/auth/[...nextauth]/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGJTVCLi4ubmV4dGF1dGglNUQlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkYlNUIuLi5uZXh0YXV0aCU1RCUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkYlNUIuLi5uZXh0YXV0aCU1RCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmd2ZXJtYSUyRkRlc2t0b3AlMkZBQVJBSUslMjBMTEMlMkZBYm9kZV9BSSUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZndmVybWElMkZEZXNrdG9wJTJGQUFSQUlLJTIwTExDJTJGQWJvZGVfQUkmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzZCO0FBQzFHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8/ODczYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvZ3Zlcm1hL0Rlc2t0b3AvQUFSQUlLIExMQy9BYm9kZV9BSS9hcHAvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hdXRoL1suLi5uZXh0YXV0aF0vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvZ3Zlcm1hL0Rlc2t0b3AvQUFSQUlLIExMQy9BYm9kZV9BSS9hcHAvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2FUsers%2Fgverma%2FDesktop%2FAARAIK%20LLC%2FAbode_AI%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgverma%2FDesktop%2FAARAIK%20LLC%2FAbode_AI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/auth/[...nextauth]/route.ts":
/*!*********************************************!*\
  !*** ./app/api/auth/[...nextauth]/route.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var request_ip__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! request-ip */ \"(rsc)/./node_modules/request-ip/lib/index.js\");\n/* harmony import */ var request_ip__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(request_ip__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_auth_options__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth/options */ \"(rsc)/./lib/auth/options.ts\");\n/* harmony import */ var _lib_auth_geo__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/auth/geo */ \"(rsc)/./lib/auth/geo.ts\");\n/* harmony import */ var _lib_auth_request_context__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/auth/request-context */ \"(rsc)/./lib/auth/request-context.ts\");\n\n\n\n\n\nconst handler = next_auth__WEBPACK_IMPORTED_MODULE_0___default()(_lib_auth_options__WEBPACK_IMPORTED_MODULE_2__.authOptions);\nconst DEFAULT_GEO_COUNTRY = process.env.DEFAULT_GEO_COUNTRY ?? null;\nfunction resolveRequestDetails(req) {\n    const rawIp = request_ip__WEBPACK_IMPORTED_MODULE_1___default().getClientIp(req) ?? req.headers.get(\"x-forwarded-for\")?.split(\",\")[0]?.trim() ?? req.headers.get(\"x-real-ip\") ?? undefined;\n    const ipAddress = (0,_lib_auth_geo__WEBPACK_IMPORTED_MODULE_3__.normalizeIp)(rawIp);\n    const headerCountry = req.headers.get(\"cf-ipcountry\") ?? req.headers.get(\"x-geo-country\") ?? null;\n    const geoCountry = (0,_lib_auth_geo__WEBPACK_IMPORTED_MODULE_3__.deriveGeoCountry)({\n        ipAddress,\n        headerCountry,\n        defaultCountry: DEFAULT_GEO_COUNTRY\n    });\n    const userAgent = req.headers.get(\"user-agent\") ?? undefined;\n    return {\n        ipAddress: ipAddress ?? undefined,\n        geoCountry: geoCountry ?? undefined,\n        userAgent\n    };\n}\nfunction GET(req) {\n    const { ipAddress, geoCountry, userAgent } = resolveRequestDetails(req);\n    return (0,_lib_auth_request_context__WEBPACK_IMPORTED_MODULE_4__.runWithAuthRequestContext)({\n        request: req,\n        ipAddress,\n        geoCountry,\n        userAgent\n    }, ()=>handler(req));\n}\nfunction POST(req) {\n    const { ipAddress, geoCountry, userAgent } = resolveRequestDetails(req);\n    return (0,_lib_auth_request_context__WEBPACK_IMPORTED_MODULE_4__.runWithAuthRequestContext)({\n        request: req,\n        ipAddress,\n        geoCountry,\n        userAgent\n    }, ()=>handler(req));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBZ0M7QUFFRTtBQUVjO0FBQ2M7QUFDUTtBQUV0RSxNQUFNTSxVQUFVTixnREFBUUEsQ0FBQ0UsMERBQVdBO0FBRXBDLE1BQU1LLHNCQUFzQkMsUUFBUUMsR0FBRyxDQUFDRixtQkFBbUIsSUFBSTtBQUUvRCxTQUFTRyxzQkFBc0JDLEdBQWdCO0lBQzdDLE1BQU1DLFFBQVEsNkRBQXNCLENBQUNELFFBQ25DQSxJQUFJRyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxvQkFBb0JDLE1BQU0sSUFBSSxDQUFDLEVBQUUsRUFBRUMsVUFDbkROLElBQUlHLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGdCQUFnQkc7SUFFbEMsTUFBTUMsWUFBWWYsMERBQVdBLENBQUNRO0lBQzlCLE1BQU1RLGdCQUNKVCxJQUFJRyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxtQkFBbUJKLElBQUlHLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLG9CQUFvQjtJQUN6RSxNQUFNTSxhQUFhbEIsK0RBQWdCQSxDQUFDO1FBQ2xDZ0I7UUFDQUM7UUFDQUUsZ0JBQWdCZjtJQUNsQjtJQUVBLE1BQU1nQixZQUFZWixJQUFJRyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxpQkFBaUJHO0lBRW5ELE9BQU87UUFBRUMsV0FBV0EsYUFBYUQ7UUFBV0csWUFBWUEsY0FBY0g7UUFBV0s7SUFBVTtBQUM3RjtBQUVPLFNBQVNDLElBQUliLEdBQWdCO0lBQ2xDLE1BQU0sRUFBRVEsU0FBUyxFQUFFRSxVQUFVLEVBQUVFLFNBQVMsRUFBRSxHQUFHYixzQkFBc0JDO0lBQ25FLE9BQU9OLG9GQUF5QkEsQ0FBQztRQUFFb0IsU0FBU2Q7UUFBS1E7UUFBV0U7UUFBWUU7SUFBVSxHQUFHLElBQU1qQixRQUFRSztBQUNyRztBQUVPLFNBQVNlLEtBQUtmLEdBQWdCO0lBQ25DLE1BQU0sRUFBRVEsU0FBUyxFQUFFRSxVQUFVLEVBQUVFLFNBQVMsRUFBRSxHQUFHYixzQkFBc0JDO0lBQ25FLE9BQU9OLG9GQUF5QkEsQ0FBQztRQUFFb0IsU0FBU2Q7UUFBS1E7UUFBV0U7UUFBWUU7SUFBVSxHQUFHLElBQU1qQixRQUFRSztBQUNyRyIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9hcHAvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS9yb3V0ZS50cz9jOGE0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBOZXh0QXV0aCBmcm9tIFwibmV4dC1hdXRoXCJcbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSBcIm5leHQvc2VydmVyXCJcbmltcG9ydCByZXF1ZXN0SXAgZnJvbSBcInJlcXVlc3QtaXBcIlxuXG5pbXBvcnQgeyBhdXRoT3B0aW9ucyB9IGZyb20gXCJAL2xpYi9hdXRoL29wdGlvbnNcIlxuaW1wb3J0IHsgZGVyaXZlR2VvQ291bnRyeSwgbm9ybWFsaXplSXAgfSBmcm9tIFwiQC9saWIvYXV0aC9nZW9cIlxuaW1wb3J0IHsgcnVuV2l0aEF1dGhSZXF1ZXN0Q29udGV4dCB9IGZyb20gXCJAL2xpYi9hdXRoL3JlcXVlc3QtY29udGV4dFwiXG5cbmNvbnN0IGhhbmRsZXIgPSBOZXh0QXV0aChhdXRoT3B0aW9ucylcblxuY29uc3QgREVGQVVMVF9HRU9fQ09VTlRSWSA9IHByb2Nlc3MuZW52LkRFRkFVTFRfR0VPX0NPVU5UUlkgPz8gbnVsbFxuXG5mdW5jdGlvbiByZXNvbHZlUmVxdWVzdERldGFpbHMocmVxOiBOZXh0UmVxdWVzdCkge1xuICBjb25zdCByYXdJcCA9IChyZXF1ZXN0SXAuZ2V0Q2xpZW50SXAocmVxIGFzIGFueSkgYXMgc3RyaW5nIHwgdW5kZWZpbmVkKSA/P1xuICAgIHJlcS5oZWFkZXJzLmdldChcIngtZm9yd2FyZGVkLWZvclwiKT8uc3BsaXQoXCIsXCIpWzBdPy50cmltKCkgPz9cbiAgICByZXEuaGVhZGVycy5nZXQoXCJ4LXJlYWwtaXBcIikgPz8gdW5kZWZpbmVkXG5cbiAgY29uc3QgaXBBZGRyZXNzID0gbm9ybWFsaXplSXAocmF3SXApXG4gIGNvbnN0IGhlYWRlckNvdW50cnkgPVxuICAgIHJlcS5oZWFkZXJzLmdldChcImNmLWlwY291bnRyeVwiKSA/PyByZXEuaGVhZGVycy5nZXQoXCJ4LWdlby1jb3VudHJ5XCIpID8/IG51bGxcbiAgY29uc3QgZ2VvQ291bnRyeSA9IGRlcml2ZUdlb0NvdW50cnkoe1xuICAgIGlwQWRkcmVzcyxcbiAgICBoZWFkZXJDb3VudHJ5LFxuICAgIGRlZmF1bHRDb3VudHJ5OiBERUZBVUxUX0dFT19DT1VOVFJZLFxuICB9KVxuXG4gIGNvbnN0IHVzZXJBZ2VudCA9IHJlcS5oZWFkZXJzLmdldChcInVzZXItYWdlbnRcIikgPz8gdW5kZWZpbmVkXG5cbiAgcmV0dXJuIHsgaXBBZGRyZXNzOiBpcEFkZHJlc3MgPz8gdW5kZWZpbmVkLCBnZW9Db3VudHJ5OiBnZW9Db3VudHJ5ID8/IHVuZGVmaW5lZCwgdXNlckFnZW50IH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEdFVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHsgaXBBZGRyZXNzLCBnZW9Db3VudHJ5LCB1c2VyQWdlbnQgfSA9IHJlc29sdmVSZXF1ZXN0RGV0YWlscyhyZXEpXG4gIHJldHVybiBydW5XaXRoQXV0aFJlcXVlc3RDb250ZXh0KHsgcmVxdWVzdDogcmVxLCBpcEFkZHJlc3MsIGdlb0NvdW50cnksIHVzZXJBZ2VudCB9LCAoKSA9PiBoYW5kbGVyKHJlcSkpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgeyBpcEFkZHJlc3MsIGdlb0NvdW50cnksIHVzZXJBZ2VudCB9ID0gcmVzb2x2ZVJlcXVlc3REZXRhaWxzKHJlcSlcbiAgcmV0dXJuIHJ1bldpdGhBdXRoUmVxdWVzdENvbnRleHQoeyByZXF1ZXN0OiByZXEsIGlwQWRkcmVzcywgZ2VvQ291bnRyeSwgdXNlckFnZW50IH0sICgpID0+IGhhbmRsZXIocmVxKSlcbn1cbiJdLCJuYW1lcyI6WyJOZXh0QXV0aCIsInJlcXVlc3RJcCIsImF1dGhPcHRpb25zIiwiZGVyaXZlR2VvQ291bnRyeSIsIm5vcm1hbGl6ZUlwIiwicnVuV2l0aEF1dGhSZXF1ZXN0Q29udGV4dCIsImhhbmRsZXIiLCJERUZBVUxUX0dFT19DT1VOVFJZIiwicHJvY2VzcyIsImVudiIsInJlc29sdmVSZXF1ZXN0RGV0YWlscyIsInJlcSIsInJhd0lwIiwiZ2V0Q2xpZW50SXAiLCJoZWFkZXJzIiwiZ2V0Iiwic3BsaXQiLCJ0cmltIiwidW5kZWZpbmVkIiwiaXBBZGRyZXNzIiwiaGVhZGVyQ291bnRyeSIsImdlb0NvdW50cnkiLCJkZWZhdWx0Q291bnRyeSIsInVzZXJBZ2VudCIsIkdFVCIsInJlcXVlc3QiLCJQT1NUIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/auth/[...nextauth]/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/audit.ts":
/*!***************************!*\
  !*** ./lib/auth/audit.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   recordAuthEvent: () => (/* binding */ recordAuthEvent)\n/* harmony export */ });\n/* harmony import */ var _lib_db_supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/db/supabase */ \"(rsc)/./lib/db/supabase.ts\");\n\nasync function recordAuthEvent(event) {\n    const { error } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_0__.supabase.from(\"auth_audits\").insert({\n        user_id: event.userId,\n        organization_id: event.orgId ?? null,\n        event_type: event.eventType,\n        ip_address: event.ipAddress ?? null,\n        geo_country: event.geoCountry ?? null,\n        user_agent: event.userAgent ?? null,\n        metadata: event.metadata ?? null\n    });\n    if (error) {\n        throw new Error(`Failed to record auth audit event: ${error.message}`);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9hdWRpdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUE0QztBQVlyQyxlQUFlQyxnQkFBZ0JDLEtBQXFCO0lBQ3pELE1BQU0sRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTUgsc0RBQVFBLENBQUNJLElBQUksQ0FBQyxlQUFlQyxNQUFNLENBQUM7UUFDMURDLFNBQVNKLE1BQU1LLE1BQU07UUFDckJDLGlCQUFpQk4sTUFBTU8sS0FBSyxJQUFJO1FBQ2hDQyxZQUFZUixNQUFNUyxTQUFTO1FBQzNCQyxZQUFZVixNQUFNVyxTQUFTLElBQUk7UUFDL0JDLGFBQWFaLE1BQU1hLFVBQVUsSUFBSTtRQUNqQ0MsWUFBWWQsTUFBTWUsU0FBUyxJQUFJO1FBQy9CQyxVQUFVaEIsTUFBTWdCLFFBQVEsSUFBSTtJQUM5QjtJQUVBLElBQUlmLE9BQU87UUFDVCxNQUFNLElBQUlnQixNQUFNLENBQUMsbUNBQW1DLEVBQUVoQixNQUFNaUIsT0FBTyxDQUFDLENBQUM7SUFDdkU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9saWIvYXV0aC9hdWRpdC50cz83MzRlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSBcIkAvbGliL2RiL3N1cGFiYXNlXCJcblxuZXhwb3J0IGludGVyZmFjZSBBdXRoQXVkaXRFdmVudCB7XG4gIHVzZXJJZDogc3RyaW5nXG4gIG9yZ0lkPzogc3RyaW5nIHwgbnVsbFxuICBldmVudFR5cGU6IHN0cmluZ1xuICBpcEFkZHJlc3M/OiBzdHJpbmcgfCBudWxsXG4gIGdlb0NvdW50cnk/OiBzdHJpbmcgfCBudWxsXG4gIHVzZXJBZ2VudD86IHN0cmluZyB8IG51bGxcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVjb3JkQXV0aEV2ZW50KGV2ZW50OiBBdXRoQXVkaXRFdmVudCkge1xuICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiYXV0aF9hdWRpdHNcIikuaW5zZXJ0KHtcbiAgICB1c2VyX2lkOiBldmVudC51c2VySWQsXG4gICAgb3JnYW5pemF0aW9uX2lkOiBldmVudC5vcmdJZCA/PyBudWxsLFxuICAgIGV2ZW50X3R5cGU6IGV2ZW50LmV2ZW50VHlwZSxcbiAgICBpcF9hZGRyZXNzOiBldmVudC5pcEFkZHJlc3MgPz8gbnVsbCxcbiAgICBnZW9fY291bnRyeTogZXZlbnQuZ2VvQ291bnRyeSA/PyBudWxsLFxuICAgIHVzZXJfYWdlbnQ6IGV2ZW50LnVzZXJBZ2VudCA/PyBudWxsLFxuICAgIG1ldGFkYXRhOiBldmVudC5tZXRhZGF0YSA/PyBudWxsLFxuICB9KVxuXG4gIGlmIChlcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHJlY29yZCBhdXRoIGF1ZGl0IGV2ZW50OiAke2Vycm9yLm1lc3NhZ2V9YClcbiAgfVxufVxuIl0sIm5hbWVzIjpbInN1cGFiYXNlIiwicmVjb3JkQXV0aEV2ZW50IiwiZXZlbnQiLCJlcnJvciIsImZyb20iLCJpbnNlcnQiLCJ1c2VyX2lkIiwidXNlcklkIiwib3JnYW5pemF0aW9uX2lkIiwib3JnSWQiLCJldmVudF90eXBlIiwiZXZlbnRUeXBlIiwiaXBfYWRkcmVzcyIsImlwQWRkcmVzcyIsImdlb19jb3VudHJ5IiwiZ2VvQ291bnRyeSIsInVzZXJfYWdlbnQiLCJ1c2VyQWdlbnQiLCJtZXRhZGF0YSIsIkVycm9yIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/audit.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/geo.ts":
/*!*************************!*\
  !*** ./lib/auth/geo.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deriveGeoCountry: () => (/* binding */ deriveGeoCountry),\n/* harmony export */   normalizeIp: () => (/* binding */ normalizeIp)\n/* harmony export */ });\nconst PRIVATE_IP_PREFIXES = [\n    /^::1$/,\n    /^127\\./,\n    /^10\\./,\n    /^192\\.168\\./,\n    /^172\\.(1[6-9]|2\\d|3[0-1])\\./,\n    /^fc00:/,\n    /^fe80:/\n];\nfunction sanitizeIp(ip) {\n    if (!ip) return null;\n    const cleaned = ip.replace(/^::ffff:/, \"\").trim();\n    if (!cleaned) return null;\n    return cleaned;\n}\nfunction deriveGeoCountry(params) {\n    const header = params.headerCountry?.trim();\n    if (header) {\n        return header.toUpperCase();\n    }\n    const ip = sanitizeIp(params.ipAddress);\n    if (ip) {\n        const isPrivate = PRIVATE_IP_PREFIXES.some((pattern)=>pattern.test(ip));\n        if (!isPrivate) {\n            // TODO: plug in MaxMind/GeoIP provider. For now return placeholder to avoid nulls.\n            return params.defaultCountry?.toUpperCase() ?? null;\n        }\n    }\n    if (params.defaultCountry) {\n        return params.defaultCountry.toUpperCase();\n    }\n    return null;\n}\nfunction normalizeIp(ip) {\n    return sanitizeIp(ip);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9nZW8udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxNQUFNQSxzQkFBc0I7SUFBQztJQUFTO0lBQVU7SUFBUztJQUFlO0lBQStCO0lBQVU7Q0FBUztBQUUxSCxTQUFTQyxXQUFXQyxFQUFrQjtJQUNwQyxJQUFJLENBQUNBLElBQUksT0FBTztJQUNoQixNQUFNQyxVQUFVRCxHQUFHRSxPQUFPLENBQUMsWUFBWSxJQUFJQyxJQUFJO0lBQy9DLElBQUksQ0FBQ0YsU0FBUyxPQUFPO0lBQ3JCLE9BQU9BO0FBQ1Q7QUFFTyxTQUFTRyxpQkFBaUJDLE1BSWhDO0lBQ0MsTUFBTUMsU0FBU0QsT0FBT0UsYUFBYSxFQUFFSjtJQUNyQyxJQUFJRyxRQUFRO1FBQ1YsT0FBT0EsT0FBT0UsV0FBVztJQUMzQjtJQUVBLE1BQU1SLEtBQUtELFdBQVdNLE9BQU9JLFNBQVM7SUFDdEMsSUFBSVQsSUFBSTtRQUNOLE1BQU1VLFlBQVlaLG9CQUFvQmEsSUFBSSxDQUFDLENBQUNDLFVBQVlBLFFBQVFDLElBQUksQ0FBQ2I7UUFDckUsSUFBSSxDQUFDVSxXQUFXO1lBQ2QsbUZBQW1GO1lBQ25GLE9BQU9MLE9BQU9TLGNBQWMsRUFBRU4saUJBQWlCO1FBQ2pEO0lBQ0Y7SUFFQSxJQUFJSCxPQUFPUyxjQUFjLEVBQUU7UUFDekIsT0FBT1QsT0FBT1MsY0FBYyxDQUFDTixXQUFXO0lBQzFDO0lBRUEsT0FBTztBQUNUO0FBRU8sU0FBU08sWUFBWWYsRUFBa0I7SUFDNUMsT0FBT0QsV0FBV0M7QUFDcEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teS12MC1wcm9qZWN0Ly4vbGliL2F1dGgvZ2VvLnRzPzkxNjQiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUFJJVkFURV9JUF9QUkVGSVhFUyA9IFsvXjo6MSQvLCAvXjEyN1xcLi8sIC9eMTBcXC4vLCAvXjE5MlxcLjE2OFxcLi8sIC9eMTcyXFwuKDFbNi05XXwyXFxkfDNbMC0xXSlcXC4vLCAvXmZjMDA6LywgL15mZTgwOi9dXG5cbmZ1bmN0aW9uIHNhbml0aXplSXAoaXA/OiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHwgbnVsbCB7XG4gIGlmICghaXApIHJldHVybiBudWxsXG4gIGNvbnN0IGNsZWFuZWQgPSBpcC5yZXBsYWNlKC9eOjpmZmZmOi8sIFwiXCIpLnRyaW0oKVxuICBpZiAoIWNsZWFuZWQpIHJldHVybiBudWxsXG4gIHJldHVybiBjbGVhbmVkXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXJpdmVHZW9Db3VudHJ5KHBhcmFtczoge1xuICBpcEFkZHJlc3M/OiBzdHJpbmcgfCBudWxsXG4gIGhlYWRlckNvdW50cnk/OiBzdHJpbmcgfCBudWxsXG4gIGRlZmF1bHRDb3VudHJ5Pzogc3RyaW5nIHwgbnVsbFxufSk6IHN0cmluZyB8IG51bGwge1xuICBjb25zdCBoZWFkZXIgPSBwYXJhbXMuaGVhZGVyQ291bnRyeT8udHJpbSgpXG4gIGlmIChoZWFkZXIpIHtcbiAgICByZXR1cm4gaGVhZGVyLnRvVXBwZXJDYXNlKClcbiAgfVxuXG4gIGNvbnN0IGlwID0gc2FuaXRpemVJcChwYXJhbXMuaXBBZGRyZXNzKVxuICBpZiAoaXApIHtcbiAgICBjb25zdCBpc1ByaXZhdGUgPSBQUklWQVRFX0lQX1BSRUZJWEVTLnNvbWUoKHBhdHRlcm4pID0+IHBhdHRlcm4udGVzdChpcCkpXG4gICAgaWYgKCFpc1ByaXZhdGUpIHtcbiAgICAgIC8vIFRPRE86IHBsdWcgaW4gTWF4TWluZC9HZW9JUCBwcm92aWRlci4gRm9yIG5vdyByZXR1cm4gcGxhY2Vob2xkZXIgdG8gYXZvaWQgbnVsbHMuXG4gICAgICByZXR1cm4gcGFyYW1zLmRlZmF1bHRDb3VudHJ5Py50b1VwcGVyQ2FzZSgpID8/IG51bGxcbiAgICB9XG4gIH1cblxuICBpZiAocGFyYW1zLmRlZmF1bHRDb3VudHJ5KSB7XG4gICAgcmV0dXJuIHBhcmFtcy5kZWZhdWx0Q291bnRyeS50b1VwcGVyQ2FzZSgpXG4gIH1cblxuICByZXR1cm4gbnVsbFxufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplSXAoaXA/OiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHwgbnVsbCB7XG4gIHJldHVybiBzYW5pdGl6ZUlwKGlwKVxufVxuIl0sIm5hbWVzIjpbIlBSSVZBVEVfSVBfUFJFRklYRVMiLCJzYW5pdGl6ZUlwIiwiaXAiLCJjbGVhbmVkIiwicmVwbGFjZSIsInRyaW0iLCJkZXJpdmVHZW9Db3VudHJ5IiwicGFyYW1zIiwiaGVhZGVyIiwiaGVhZGVyQ291bnRyeSIsInRvVXBwZXJDYXNlIiwiaXBBZGRyZXNzIiwiaXNQcml2YXRlIiwic29tZSIsInBhdHRlcm4iLCJ0ZXN0IiwiZGVmYXVsdENvdW50cnkiLCJub3JtYWxpemVJcCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/geo.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/options.ts":
/*!*****************************!*\
  !*** ./lib/auth/options.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_providers_auth0__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/auth0 */ \"(rsc)/./node_modules/next-auth/providers/auth0.js\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _lib_auth_audit__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/auth/audit */ \"(rsc)/./lib/auth/audit.ts\");\n/* harmony import */ var _lib_auth_store__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/auth/store */ \"(rsc)/./lib/auth/store.ts\");\n/* harmony import */ var _lib_rbac__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/lib/rbac */ \"(rsc)/./lib/rbac.ts\");\n/* harmony import */ var _lib_auth_request_context__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/lib/auth/request-context */ \"(rsc)/./lib/auth/request-context.ts\");\n\n\n\n\n\n\n\nconst MEMBERSHIP_REFRESH_INTERVAL_MS = 2 * 60 * 1000;\nconst auth0Domain = process.env.AUTH0_ISSUER_BASE_URL;\nconst auth0ClientId = process.env.AUTH0_CLIENT_ID;\nconst auth0ClientSecret = process.env.AUTH0_CLIENT_SECRET;\nconst devAuthEnabled = process.env.DEV_AUTH_ENABLED === \"true\";\nconst devUserRoles = process.env.DEV_AUTH_ROLES?.split(\",\").map((role)=>role.trim()).filter(Boolean);\nconst devUserOrgId = process.env.DEV_AUTH_ORG_ID ?? \"demo-org\";\nconst auth0Provider = auth0Domain && auth0ClientId && auth0ClientSecret ? (0,next_auth_providers_auth0__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n    clientId: auth0ClientId,\n    clientSecret: auth0ClientSecret,\n    issuer: auth0Domain\n}) : null;\nfunction resolveRoles({ profile, user }, roleClaim) {\n    const collected = new Set();\n    if (profile) {\n        const claimedRoles = profile[roleClaim];\n        if (Array.isArray(claimedRoles)) {\n            for (const role of claimedRoles){\n                if (typeof role === \"string\" && role.trim()) {\n                    collected.add(role.trim());\n                }\n            }\n        } else if (typeof claimedRoles === \"string\" && claimedRoles.trim()) {\n            collected.add(claimedRoles.trim());\n        }\n    }\n    const typedUser = user;\n    typedUser?.roles?.forEach((role)=>{\n        if (role) collected.add(role);\n    });\n    return [\n        ...collected\n    ];\n}\nfunction resolveOrgExternalId({ profile, user }, orgClaim) {\n    const typedUser = user;\n    const fromProfile = profile ? profile[orgClaim] : undefined;\n    if (typeof fromProfile === \"string\" && fromProfile.trim()) {\n        return fromProfile.trim();\n    }\n    if (typedUser?.orgId) {\n        return typedUser.orgId;\n    }\n    return undefined;\n}\nfunction ensureRolesPresence(roles) {\n    if (!roles || roles.length === 0) {\n        return [\n            _lib_rbac__WEBPACK_IMPORTED_MODULE_5__.DEFAULT_ROLE\n        ];\n    }\n    return roles;\n}\nconst authOptions = {\n    debug: process.env.NEXTAUTH_DEBUG === \"true\",\n    secret: process.env.NEXTAUTH_SECRET,\n    session: {\n        strategy: \"jwt\"\n    },\n    providers: [\n        ...auth0Provider ? [\n            auth0Provider\n        ] : [],\n        ...devAuthEnabled ? [\n            (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_2__[\"default\"])({\n                name: \"Developer Login\",\n                credentials: {\n                    email: {\n                        label: \"Email\",\n                        type: \"email\"\n                    },\n                    name: {\n                        label: \"Name\",\n                        type: \"text\"\n                    }\n                },\n                async authorize (credentials) {\n                    if (!credentials?.email) {\n                        throw new Error(\"Email is required\");\n                    }\n                    return {\n                        id: credentials.email,\n                        email: credentials.email,\n                        name: credentials.name || \"Abode Developer\",\n                        roles: devUserRoles?.length ? devUserRoles : [\n                            _lib_rbac__WEBPACK_IMPORTED_MODULE_5__.DEFAULT_ROLE\n                        ],\n                        orgId: devUserOrgId\n                    };\n                }\n            })\n        ] : []\n    ],\n    callbacks: {\n        async jwt ({ token, account, profile, user }) {\n            if (!token.sessionId) {\n                token.sessionId = (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)();\n            }\n            const roleClaim = process.env.AUTH0_ROLE_CLAIM ?? \"https://abode.ai/roles\";\n            const orgClaim = process.env.AUTH0_ORG_CLAIM ?? \"https://abode.ai/orgId\";\n            if (account) {\n                try {\n                    const providerAccountId = account.provider === \"credentials\" ? `credentials:${user?.id ?? token.email ?? token.sub ?? (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)()}` : account.providerAccountId ?? token.sub ?? (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)();\n                    const resolvedRoles = resolveRoles({\n                        profile: profile,\n                        user\n                    }, roleClaim);\n                    const orgExternalId = resolveOrgExternalId({\n                        profile: profile,\n                        user\n                    }, orgClaim) ?? devUserOrgId;\n                    let resolvedOrgExternalId = orgExternalId;\n                    const supabaseUser = await (0,_lib_auth_store__WEBPACK_IMPORTED_MODULE_4__.ensureUser)({\n                        auth0UserId: providerAccountId,\n                        email: profile?.email ?? user?.email ?? token.email,\n                        displayName: profile?.name ?? user?.name ?? token.name\n                    });\n                    let membershipOrgId;\n                    let finalRoles = ensureRolesPresence(resolvedRoles);\n                    if (orgExternalId) {\n                        const organization = await (0,_lib_auth_store__WEBPACK_IMPORTED_MODULE_4__.ensureOrganization)(orgExternalId, profile?.organization);\n                        membershipOrgId = organization.id;\n                        resolvedOrgExternalId = organization.external_ref ?? orgExternalId;\n                        (0,_lib_auth_request_context__WEBPACK_IMPORTED_MODULE_6__.setAuthRequestMetadata)({\n                            orgExternalId: resolvedOrgExternalId\n                        });\n                        const membership = await (0,_lib_auth_store__WEBPACK_IMPORTED_MODULE_4__.ensureMembership)({\n                            userId: supabaseUser.id,\n                            organizationId: organization.id,\n                            roles: finalRoles,\n                            actorUserId: supabaseUser.id\n                        });\n                        membershipOrgId = membership.organization_id;\n                        finalRoles = ensureRolesPresence(membership.roles);\n                    }\n                    token.userId = supabaseUser.id;\n                    token.orgId = membershipOrgId;\n                    token.orgExternalId = resolvedOrgExternalId;\n                    token.roles = finalRoles;\n                    token.membershipSyncedAt = Date.now();\n                    const context = (0,_lib_auth_request_context__WEBPACK_IMPORTED_MODULE_6__.getAuthRequestContext)();\n                    (0,_lib_auth_request_context__WEBPACK_IMPORTED_MODULE_6__.setAuthRequestMetadata)({\n                        sessionId: token.sessionId,\n                        userId: supabaseUser.id,\n                        organizationId: membershipOrgId,\n                        roles: finalRoles,\n                        geoCountry: context?.geoCountry\n                    });\n                } catch (error) {\n                    console.error(\"Failed to synchronise Auth0 state with Supabase\", error);\n                    token.roles = ensureRolesPresence(token.roles);\n                }\n            } else if (token.userId && token.orgId) {\n                const lastSynced = typeof token.membershipSyncedAt === \"number\" ? token.membershipSyncedAt : 0;\n                if (Date.now() - lastSynced > MEMBERSHIP_REFRESH_INTERVAL_MS) {\n                    try {\n                        const membership = await (0,_lib_auth_store__WEBPACK_IMPORTED_MODULE_4__.getMembership)(token.userId, token.orgId);\n                        if (membership?.roles?.length) {\n                            token.roles = membership.roles;\n                        }\n                        token.membershipSyncedAt = Date.now();\n                    } catch (error) {\n                        console.error(\"Failed to refresh membership roles\", error);\n                    }\n                }\n            }\n            token.roles = ensureRolesPresence(token.roles);\n            return token;\n        },\n        async session ({ session, token }) {\n            const roles = ensureRolesPresence(token.roles);\n            const permissions = [\n                ...(0,_lib_rbac__WEBPACK_IMPORTED_MODULE_5__.collectUserPermissions)(roles)\n            ];\n            const orgId = token.orgId ?? session.user?.orgId;\n            session.user = {\n                ...session.user,\n                id: token.userId ?? session.user?.id,\n                email: token.email ?? session.user?.email ?? null,\n                name: token.name ?? session.user?.name ?? null,\n                roles,\n                orgId,\n                orgExternalId: token.orgExternalId ?? session.user?.orgExternalId,\n                permissions\n            };\n            session.sessionId = token.sessionId;\n            return session;\n        }\n    },\n    events: {\n        async signIn (message) {\n            try {\n                const context = (0,_lib_auth_request_context__WEBPACK_IMPORTED_MODULE_6__.getAuthRequestContext)();\n                const providerAccountId = message.account?.providerAccountId;\n                const metadata = context?.metadata;\n                let userId = metadata?.userId;\n                if (!userId && providerAccountId) {\n                    const supabaseUser = await (0,_lib_auth_store__WEBPACK_IMPORTED_MODULE_4__.getUserByAuthProvider)(providerAccountId);\n                    userId = supabaseUser?.id;\n                }\n                if (!userId) {\n                    return;\n                }\n                const sessionId = metadata?.sessionId ?? (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)();\n                if (!metadata?.sessionId) {\n                    (0,_lib_auth_request_context__WEBPACK_IMPORTED_MODULE_6__.setAuthRequestMetadata)({\n                        sessionId\n                    });\n                }\n                await (0,_lib_auth_store__WEBPACK_IMPORTED_MODULE_4__.recordUserSession)({\n                    sessionId,\n                    userId,\n                    organizationId: metadata?.organizationId ?? null,\n                    ipAddress: context?.ipAddress ?? null,\n                    geoCountry: context?.geoCountry ?? null,\n                    userAgent: context?.userAgent ?? null,\n                    metadata: {\n                        provider: message.account?.provider,\n                        isNewUser: message.isNewUser ?? false,\n                        roles: metadata?.roles\n                    }\n                });\n                await (0,_lib_auth_audit__WEBPACK_IMPORTED_MODULE_3__.recordAuthEvent)({\n                    userId,\n                    orgId: metadata?.organizationId ?? null,\n                    eventType: \"login.success\",\n                    ipAddress: context?.ipAddress ?? null,\n                    geoCountry: context?.geoCountry ?? null,\n                    userAgent: context?.userAgent ?? null,\n                    metadata: {\n                        provider: message.account?.provider,\n                        isNewUser: message.isNewUser ?? false\n                    }\n                });\n            } catch (error) {\n                console.error(\"Failed to record sign-in audit\", error);\n            }\n        },\n        async signOut ({ token }) {\n            try {\n                const sessionId = token.sessionId ?? undefined;\n                const userId = token.userId ?? undefined;\n                const orgId = token.orgId ?? undefined;\n                if (sessionId) {\n                    await (0,_lib_auth_store__WEBPACK_IMPORTED_MODULE_4__.endUserSession)(sessionId);\n                }\n                if (userId) {\n                    await (0,_lib_auth_audit__WEBPACK_IMPORTED_MODULE_3__.recordAuthEvent)({\n                        userId,\n                        orgId,\n                        eventType: \"logout\"\n                    });\n                }\n            } catch (error) {\n                console.error(\"Failed to record sign-out audit\", error);\n            }\n        },\n        async session ({ token }) {\n            try {\n                const sessionId = token.sessionId;\n                if (sessionId) {\n                    await (0,_lib_auth_store__WEBPACK_IMPORTED_MODULE_4__.touchUserSession)(sessionId);\n                }\n            } catch (error) {\n                console.error(\"Failed to record session heartbeat\", error);\n            }\n        }\n    },\n    pages: {\n        signIn: \"/auth/sign-in\"\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YWNrOi8vbXktdjAtcHJvamVjdC8uL2xpYi9hdXRoL29wdGlvbnMudHM/YzQ4ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSBcImNyeXB0b1wiXG5cbmltcG9ydCB0eXBlIHsgTmV4dEF1dGhPcHRpb25zIH0gZnJvbSBcIm5leHQtYXV0aFwiXG5pbXBvcnQgQXV0aDBQcm92aWRlciBmcm9tIFwibmV4dC1hdXRoL3Byb3ZpZGVycy9hdXRoMFwiXG5pbXBvcnQgQ3JlZGVudGlhbHNQcm92aWRlciBmcm9tIFwibmV4dC1hdXRoL3Byb3ZpZGVycy9jcmVkZW50aWFsc1wiXG5cbmltcG9ydCB7IHJlY29yZEF1dGhFdmVudCB9IGZyb20gXCJAL2xpYi9hdXRoL2F1ZGl0XCJcbmltcG9ydCB7XG4gIGVuZFVzZXJTZXNzaW9uLFxuICBlbnN1cmVNZW1iZXJzaGlwLFxuICBlbnN1cmVPcmdhbml6YXRpb24sXG4gIGVuc3VyZVVzZXIsXG4gIGdldE1lbWJlcnNoaXAsXG4gIGdldFVzZXJCeUF1dGhQcm92aWRlcixcbiAgcmVjb3JkVXNlclNlc3Npb24sXG4gIHRvdWNoVXNlclNlc3Npb24sXG59IGZyb20gXCJAL2xpYi9hdXRoL3N0b3JlXCJcbmltcG9ydCB7IGNvbGxlY3RVc2VyUGVybWlzc2lvbnMsIERFRkFVTFRfUk9MRSB9IGZyb20gXCJAL2xpYi9yYmFjXCJcbmltcG9ydCB7IGdldEF1dGhSZXF1ZXN0Q29udGV4dCwgc2V0QXV0aFJlcXVlc3RNZXRhZGF0YSB9IGZyb20gXCJAL2xpYi9hdXRoL3JlcXVlc3QtY29udGV4dFwiXG5cbmNvbnN0IE1FTUJFUlNISVBfUkVGUkVTSF9JTlRFUlZBTF9NUyA9IDIgKiA2MCAqIDEwMDBcblxuY29uc3QgYXV0aDBEb21haW4gPSBwcm9jZXNzLmVudi5BVVRIMF9JU1NVRVJfQkFTRV9VUkxcbmNvbnN0IGF1dGgwQ2xpZW50SWQgPSBwcm9jZXNzLmVudi5BVVRIMF9DTElFTlRfSURcbmNvbnN0IGF1dGgwQ2xpZW50U2VjcmV0ID0gcHJvY2Vzcy5lbnYuQVVUSDBfQ0xJRU5UX1NFQ1JFVFxuXG5jb25zdCBkZXZBdXRoRW5hYmxlZCA9IHByb2Nlc3MuZW52LkRFVl9BVVRIX0VOQUJMRUQgPT09IFwidHJ1ZVwiXG5jb25zdCBkZXZVc2VyUm9sZXMgPSBwcm9jZXNzLmVudi5ERVZfQVVUSF9ST0xFUz8uc3BsaXQoXCIsXCIpLm1hcCgocm9sZSkgPT4gcm9sZS50cmltKCkpLmZpbHRlcihCb29sZWFuKVxuY29uc3QgZGV2VXNlck9yZ0lkID0gcHJvY2Vzcy5lbnYuREVWX0FVVEhfT1JHX0lEID8/IFwiZGVtby1vcmdcIlxuXG5jb25zdCBhdXRoMFByb3ZpZGVyID1cbiAgYXV0aDBEb21haW4gJiYgYXV0aDBDbGllbnRJZCAmJiBhdXRoMENsaWVudFNlY3JldFxuICAgID8gQXV0aDBQcm92aWRlcih7XG4gICAgICAgIGNsaWVudElkOiBhdXRoMENsaWVudElkLFxuICAgICAgICBjbGllbnRTZWNyZXQ6IGF1dGgwQ2xpZW50U2VjcmV0LFxuICAgICAgICBpc3N1ZXI6IGF1dGgwRG9tYWluLFxuICAgICAgfSlcbiAgICA6IG51bGxcblxudHlwZSBBdXRoUHJvZmlsZSA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHwgdW5kZWZpbmVkXG5cbmZ1bmN0aW9uIHJlc29sdmVSb2xlcyh7IHByb2ZpbGUsIHVzZXIgfTogeyBwcm9maWxlOiBBdXRoUHJvZmlsZTsgdXNlcj86IHVua25vd24gfSwgcm9sZUNsYWltOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIGNvbnN0IGNvbGxlY3RlZCA9IG5ldyBTZXQ8c3RyaW5nPigpXG5cbiAgaWYgKHByb2ZpbGUpIHtcbiAgICBjb25zdCBjbGFpbWVkUm9sZXMgPSAocHJvZmlsZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPilbcm9sZUNsYWltXVxuICAgIGlmIChBcnJheS5pc0FycmF5KGNsYWltZWRSb2xlcykpIHtcbiAgICAgIGZvciAoY29uc3Qgcm9sZSBvZiBjbGFpbWVkUm9sZXMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiByb2xlID09PSBcInN0cmluZ1wiICYmIHJvbGUudHJpbSgpKSB7XG4gICAgICAgICAgY29sbGVjdGVkLmFkZChyb2xlLnRyaW0oKSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGNsYWltZWRSb2xlcyA9PT0gXCJzdHJpbmdcIiAmJiBjbGFpbWVkUm9sZXMudHJpbSgpKSB7XG4gICAgICBjb2xsZWN0ZWQuYWRkKGNsYWltZWRSb2xlcy50cmltKCkpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdHlwZWRVc2VyID0gdXNlciBhcyBQYXJ0aWFsPHsgcm9sZXM6IHN0cmluZ1tdIH0+IHwgdW5kZWZpbmVkXG4gIHR5cGVkVXNlcj8ucm9sZXM/LmZvckVhY2goKHJvbGUpID0+IHtcbiAgICBpZiAocm9sZSkgY29sbGVjdGVkLmFkZChyb2xlKVxuICB9KVxuXG4gIHJldHVybiBbLi4uY29sbGVjdGVkXVxufVxuXG5mdW5jdGlvbiByZXNvbHZlT3JnRXh0ZXJuYWxJZCh7IHByb2ZpbGUsIHVzZXIgfTogeyBwcm9maWxlOiBBdXRoUHJvZmlsZTsgdXNlcj86IHVua25vd24gfSwgb3JnQ2xhaW06IHN0cmluZykge1xuICBjb25zdCB0eXBlZFVzZXIgPSB1c2VyIGFzIFBhcnRpYWw8eyBvcmdJZD86IHN0cmluZyB9PiB8IHVuZGVmaW5lZFxuICBjb25zdCBmcm9tUHJvZmlsZSA9IHByb2ZpbGUgPyAocHJvZmlsZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPilbb3JnQ2xhaW1dIDogdW5kZWZpbmVkXG4gIGlmICh0eXBlb2YgZnJvbVByb2ZpbGUgPT09IFwic3RyaW5nXCIgJiYgZnJvbVByb2ZpbGUudHJpbSgpKSB7XG4gICAgcmV0dXJuIGZyb21Qcm9maWxlLnRyaW0oKVxuICB9XG4gIGlmICh0eXBlZFVzZXI/Lm9yZ0lkKSB7XG4gICAgcmV0dXJuIHR5cGVkVXNlci5vcmdJZFxuICB9XG4gIHJldHVybiB1bmRlZmluZWRcbn1cblxuZnVuY3Rpb24gZW5zdXJlUm9sZXNQcmVzZW5jZShyb2xlczogc3RyaW5nW10gfCB1bmRlZmluZWQpIHtcbiAgaWYgKCFyb2xlcyB8fCByb2xlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gW0RFRkFVTFRfUk9MRV1cbiAgfVxuICByZXR1cm4gcm9sZXNcbn1cblxuZXhwb3J0IGNvbnN0IGF1dGhPcHRpb25zOiBOZXh0QXV0aE9wdGlvbnMgPSB7XG4gIGRlYnVnOiBwcm9jZXNzLmVudi5ORVhUQVVUSF9ERUJVRyA9PT0gXCJ0cnVlXCIsXG4gIHNlY3JldDogcHJvY2Vzcy5lbnYuTkVYVEFVVEhfU0VDUkVULFxuICBzZXNzaW9uOiB7XG4gICAgc3RyYXRlZ3k6IFwiand0XCIsXG4gIH0sXG4gIHByb3ZpZGVyczogW1xuICAgIC4uLihhdXRoMFByb3ZpZGVyID8gW2F1dGgwUHJvdmlkZXJdIDogW10pLFxuICAgIC4uLihkZXZBdXRoRW5hYmxlZFxuICAgICAgPyBbXG4gICAgICAgICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XG4gICAgICAgICAgICBuYW1lOiBcIkRldmVsb3BlciBMb2dpblwiLFxuICAgICAgICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgICAgICAgZW1haWw6IHsgbGFiZWw6IFwiRW1haWxcIiwgdHlwZTogXCJlbWFpbFwiIH0sXG4gICAgICAgICAgICAgIG5hbWU6IHsgbGFiZWw6IFwiTmFtZVwiLCB0eXBlOiBcInRleHRcIiB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGFzeW5jIGF1dGhvcml6ZShjcmVkZW50aWFscykge1xuICAgICAgICAgICAgICBpZiAoIWNyZWRlbnRpYWxzPy5lbWFpbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVtYWlsIGlzIHJlcXVpcmVkXCIpXG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGlkOiBjcmVkZW50aWFscy5lbWFpbCxcbiAgICAgICAgICAgICAgICBlbWFpbDogY3JlZGVudGlhbHMuZW1haWwsXG4gICAgICAgICAgICAgICAgbmFtZTogY3JlZGVudGlhbHMubmFtZSB8fCBcIkFib2RlIERldmVsb3BlclwiLFxuICAgICAgICAgICAgICAgIHJvbGVzOiBkZXZVc2VyUm9sZXM/Lmxlbmd0aCA/IGRldlVzZXJSb2xlcyA6IFtERUZBVUxUX1JPTEVdLFxuICAgICAgICAgICAgICAgIG9yZ0lkOiBkZXZVc2VyT3JnSWQsXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIF1cbiAgICAgIDogW10pLFxuICBdLFxuICBjYWxsYmFja3M6IHtcbiAgICBhc3luYyBqd3QoeyB0b2tlbiwgYWNjb3VudCwgcHJvZmlsZSwgdXNlciB9KSB7XG4gICAgICBpZiAoIXRva2VuLnNlc3Npb25JZCkge1xuICAgICAgICB0b2tlbi5zZXNzaW9uSWQgPSByYW5kb21VVUlEKClcbiAgICAgIH1cblxuICAgICAgY29uc3Qgcm9sZUNsYWltID0gcHJvY2Vzcy5lbnYuQVVUSDBfUk9MRV9DTEFJTSA/PyBcImh0dHBzOi8vYWJvZGUuYWkvcm9sZXNcIlxuICAgICAgY29uc3Qgb3JnQ2xhaW0gPSBwcm9jZXNzLmVudi5BVVRIMF9PUkdfQ0xBSU0gPz8gXCJodHRwczovL2Fib2RlLmFpL29yZ0lkXCJcblxuICAgICAgaWYgKGFjY291bnQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBwcm92aWRlckFjY291bnRJZCA9XG4gICAgICAgICAgICBhY2NvdW50LnByb3ZpZGVyID09PSBcImNyZWRlbnRpYWxzXCJcbiAgICAgICAgICAgICAgPyBgY3JlZGVudGlhbHM6JHsodXNlciBhcyB7IGlkPzogc3RyaW5nOyBlbWFpbD86IHN0cmluZyB9IHwgdW5kZWZpbmVkKT8uaWQgPz8gdG9rZW4uZW1haWwgPz8gdG9rZW4uc3ViID8/IHJhbmRvbVVVSUQoKX1gXG4gICAgICAgICAgICAgIDogYWNjb3VudC5wcm92aWRlckFjY291bnRJZCA/PyAodG9rZW4uc3ViIGFzIHN0cmluZyB8IHVuZGVmaW5lZCkgPz8gcmFuZG9tVVVJRCgpXG5cbiAgICAgICAgICBjb25zdCByZXNvbHZlZFJvbGVzID0gcmVzb2x2ZVJvbGVzKHsgcHJvZmlsZTogcHJvZmlsZSBhcyBBdXRoUHJvZmlsZSwgdXNlciB9LCByb2xlQ2xhaW0pXG4gICAgICAgICAgY29uc3Qgb3JnRXh0ZXJuYWxJZCA9XG4gICAgICAgICAgICByZXNvbHZlT3JnRXh0ZXJuYWxJZCh7IHByb2ZpbGU6IHByb2ZpbGUgYXMgQXV0aFByb2ZpbGUsIHVzZXIgfSwgb3JnQ2xhaW0pID8/IGRldlVzZXJPcmdJZFxuICAgICAgICAgIGxldCByZXNvbHZlZE9yZ0V4dGVybmFsSWQgPSBvcmdFeHRlcm5hbElkXG5cbiAgICAgICAgICBjb25zdCBzdXBhYmFzZVVzZXIgPSBhd2FpdCBlbnN1cmVVc2VyKHtcbiAgICAgICAgICAgIGF1dGgwVXNlcklkOiBwcm92aWRlckFjY291bnRJZCxcbiAgICAgICAgICAgIGVtYWlsOiAocHJvZmlsZSBhcyBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCB1bmRlZmluZWQ+IHwgdW5kZWZpbmVkKT8uZW1haWwgPz8gdXNlcj8uZW1haWwgPz8gdG9rZW4uZW1haWwsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogKHByb2ZpbGUgYXMgUmVjb3JkPHN0cmluZywgc3RyaW5nIHwgdW5kZWZpbmVkPiB8IHVuZGVmaW5lZCk/Lm5hbWUgPz8gdXNlcj8ubmFtZSA/PyB0b2tlbi5uYW1lLFxuICAgICAgICAgIH0pXG5cbiAgICAgICAgICBsZXQgbWVtYmVyc2hpcE9yZ0lkOiBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICAgICAgICBsZXQgZmluYWxSb2xlczogc3RyaW5nW10gPSBlbnN1cmVSb2xlc1ByZXNlbmNlKHJlc29sdmVkUm9sZXMpXG5cbiAgICAgICAgICBpZiAob3JnRXh0ZXJuYWxJZCkge1xuICAgICAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uID0gYXdhaXQgZW5zdXJlT3JnYW5pemF0aW9uKG9yZ0V4dGVybmFsSWQsIChwcm9maWxlIGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZyB8IHVuZGVmaW5lZD4gfCB1bmRlZmluZWQpPy5vcmdhbml6YXRpb24pXG4gICAgICAgICAgICBtZW1iZXJzaGlwT3JnSWQgPSBvcmdhbml6YXRpb24uaWRcbiAgICAgICAgICAgIHJlc29sdmVkT3JnRXh0ZXJuYWxJZCA9IG9yZ2FuaXphdGlvbi5leHRlcm5hbF9yZWYgPz8gb3JnRXh0ZXJuYWxJZFxuICAgICAgICAgICAgc2V0QXV0aFJlcXVlc3RNZXRhZGF0YSh7IG9yZ0V4dGVybmFsSWQ6IHJlc29sdmVkT3JnRXh0ZXJuYWxJZCB9KVxuXG4gICAgICAgICAgICBjb25zdCBtZW1iZXJzaGlwID0gYXdhaXQgZW5zdXJlTWVtYmVyc2hpcCh7XG4gICAgICAgICAgICAgIHVzZXJJZDogc3VwYWJhc2VVc2VyLmlkLFxuICAgICAgICAgICAgICBvcmdhbml6YXRpb25JZDogb3JnYW5pemF0aW9uLmlkLFxuICAgICAgICAgICAgICByb2xlczogZmluYWxSb2xlcyxcbiAgICAgICAgICAgICAgYWN0b3JVc2VySWQ6IHN1cGFiYXNlVXNlci5pZCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBtZW1iZXJzaGlwT3JnSWQgPSBtZW1iZXJzaGlwLm9yZ2FuaXphdGlvbl9pZFxuICAgICAgICAgICAgZmluYWxSb2xlcyA9IGVuc3VyZVJvbGVzUHJlc2VuY2UobWVtYmVyc2hpcC5yb2xlcylcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0b2tlbi51c2VySWQgPSBzdXBhYmFzZVVzZXIuaWRcbiAgICAgICAgICB0b2tlbi5vcmdJZCA9IG1lbWJlcnNoaXBPcmdJZFxuICAgICAgICAgIHRva2VuLm9yZ0V4dGVybmFsSWQgPSByZXNvbHZlZE9yZ0V4dGVybmFsSWRcbiAgICAgICAgICB0b2tlbi5yb2xlcyA9IGZpbmFsUm9sZXNcbiAgICAgICAgICB0b2tlbi5tZW1iZXJzaGlwU3luY2VkQXQgPSBEYXRlLm5vdygpXG5cbiAgICAgICAgICBjb25zdCBjb250ZXh0ID0gZ2V0QXV0aFJlcXVlc3RDb250ZXh0KClcblxuICAgICAgICAgIHNldEF1dGhSZXF1ZXN0TWV0YWRhdGEoe1xuICAgICAgICAgICAgc2Vzc2lvbklkOiB0b2tlbi5zZXNzaW9uSWQgYXMgc3RyaW5nLFxuICAgICAgICAgICAgdXNlcklkOiBzdXBhYmFzZVVzZXIuaWQsXG4gICAgICAgICAgICBvcmdhbml6YXRpb25JZDogbWVtYmVyc2hpcE9yZ0lkLFxuICAgICAgICAgICAgcm9sZXM6IGZpbmFsUm9sZXMsXG4gICAgICAgICAgICBnZW9Db3VudHJ5OiBjb250ZXh0Py5nZW9Db3VudHJ5LFxuICAgICAgICAgIH0pXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzeW5jaHJvbmlzZSBBdXRoMCBzdGF0ZSB3aXRoIFN1cGFiYXNlXCIsIGVycm9yKVxuICAgICAgICAgIHRva2VuLnJvbGVzID0gZW5zdXJlUm9sZXNQcmVzZW5jZSh0b2tlbi5yb2xlcyBhcyBzdHJpbmdbXSB8IHVuZGVmaW5lZClcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0b2tlbi51c2VySWQgJiYgdG9rZW4ub3JnSWQpIHtcbiAgICAgICAgY29uc3QgbGFzdFN5bmNlZCA9IHR5cGVvZiB0b2tlbi5tZW1iZXJzaGlwU3luY2VkQXQgPT09IFwibnVtYmVyXCIgPyB0b2tlbi5tZW1iZXJzaGlwU3luY2VkQXQgOiAwXG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gbGFzdFN5bmNlZCA+IE1FTUJFUlNISVBfUkVGUkVTSF9JTlRFUlZBTF9NUykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBtZW1iZXJzaGlwID0gYXdhaXQgZ2V0TWVtYmVyc2hpcCh0b2tlbi51c2VySWQgYXMgc3RyaW5nLCB0b2tlbi5vcmdJZCBhcyBzdHJpbmcpXG4gICAgICAgICAgICBpZiAobWVtYmVyc2hpcD8ucm9sZXM/Lmxlbmd0aCkge1xuICAgICAgICAgICAgICB0b2tlbi5yb2xlcyA9IG1lbWJlcnNoaXAucm9sZXNcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRva2VuLm1lbWJlcnNoaXBTeW5jZWRBdCA9IERhdGUubm93KClcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byByZWZyZXNoIG1lbWJlcnNoaXAgcm9sZXNcIiwgZXJyb3IpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRva2VuLnJvbGVzID0gZW5zdXJlUm9sZXNQcmVzZW5jZSh0b2tlbi5yb2xlcyBhcyBzdHJpbmdbXSB8IHVuZGVmaW5lZClcbiAgICAgIHJldHVybiB0b2tlblxuICAgIH0sXG4gICAgYXN5bmMgc2Vzc2lvbih7IHNlc3Npb24sIHRva2VuIH0pIHtcbiAgICAgIGNvbnN0IHJvbGVzID0gZW5zdXJlUm9sZXNQcmVzZW5jZSh0b2tlbi5yb2xlcyBhcyBzdHJpbmdbXSB8IHVuZGVmaW5lZClcbiAgICAgIGNvbnN0IHBlcm1pc3Npb25zID0gWy4uLmNvbGxlY3RVc2VyUGVybWlzc2lvbnMocm9sZXMpXVxuICAgICAgY29uc3Qgb3JnSWQgPSAodG9rZW4ub3JnSWQgYXMgc3RyaW5nIHwgdW5kZWZpbmVkKSA/PyAoc2Vzc2lvbi51c2VyPy5vcmdJZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQpXG5cbiAgICAgIHNlc3Npb24udXNlciA9IHtcbiAgICAgICAgLi4uc2Vzc2lvbi51c2VyLFxuICAgICAgICBpZDogKHRva2VuLnVzZXJJZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQpID8/IHNlc3Npb24udXNlcj8uaWQsXG4gICAgICAgIGVtYWlsOiAodG9rZW4uZW1haWwgYXMgc3RyaW5nIHwgdW5kZWZpbmVkKSA/PyBzZXNzaW9uLnVzZXI/LmVtYWlsID8/IG51bGwsXG4gICAgICAgIG5hbWU6ICh0b2tlbi5uYW1lIGFzIHN0cmluZyB8IHVuZGVmaW5lZCkgPz8gc2Vzc2lvbi51c2VyPy5uYW1lID8/IG51bGwsXG4gICAgICAgIHJvbGVzLFxuICAgICAgICBvcmdJZCxcbiAgICAgICAgb3JnRXh0ZXJuYWxJZDogKHRva2VuLm9yZ0V4dGVybmFsSWQgYXMgc3RyaW5nIHwgdW5kZWZpbmVkKSA/PyBzZXNzaW9uLnVzZXI/Lm9yZ0V4dGVybmFsSWQsXG4gICAgICAgIHBlcm1pc3Npb25zLFxuICAgICAgfVxuXG4gICAgICA7KHNlc3Npb24gYXMgdW5rbm93biBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuc2Vzc2lvbklkID0gdG9rZW4uc2Vzc2lvbklkXG4gICAgICByZXR1cm4gc2Vzc2lvblxuICAgIH0sXG4gIH0sXG4gIGV2ZW50czoge1xuICAgIGFzeW5jIHNpZ25JbihtZXNzYWdlKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gZ2V0QXV0aFJlcXVlc3RDb250ZXh0KClcbiAgICAgICAgY29uc3QgcHJvdmlkZXJBY2NvdW50SWQgPSBtZXNzYWdlLmFjY291bnQ/LnByb3ZpZGVyQWNjb3VudElkXG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0gY29udGV4dD8ubWV0YWRhdGFcblxuICAgICAgICBsZXQgdXNlcklkID0gbWV0YWRhdGE/LnVzZXJJZFxuICAgICAgICBpZiAoIXVzZXJJZCAmJiBwcm92aWRlckFjY291bnRJZCkge1xuICAgICAgICAgIGNvbnN0IHN1cGFiYXNlVXNlciA9IGF3YWl0IGdldFVzZXJCeUF1dGhQcm92aWRlcihwcm92aWRlckFjY291bnRJZClcbiAgICAgICAgICB1c2VySWQgPSBzdXBhYmFzZVVzZXI/LmlkXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2Vzc2lvbklkID0gbWV0YWRhdGE/LnNlc3Npb25JZCA/PyByYW5kb21VVUlEKClcbiAgICAgICAgaWYgKCFtZXRhZGF0YT8uc2Vzc2lvbklkKSB7XG4gICAgICAgICAgc2V0QXV0aFJlcXVlc3RNZXRhZGF0YSh7IHNlc3Npb25JZCB9KVxuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgcmVjb3JkVXNlclNlc3Npb24oe1xuICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IG1ldGFkYXRhPy5vcmdhbml6YXRpb25JZCA/PyBudWxsLFxuICAgICAgICAgIGlwQWRkcmVzczogY29udGV4dD8uaXBBZGRyZXNzID8/IG51bGwsXG4gICAgICAgICAgZ2VvQ291bnRyeTogY29udGV4dD8uZ2VvQ291bnRyeSA/PyBudWxsLFxuICAgICAgICAgIHVzZXJBZ2VudDogY29udGV4dD8udXNlckFnZW50ID8/IG51bGwsXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIHByb3ZpZGVyOiBtZXNzYWdlLmFjY291bnQ/LnByb3ZpZGVyLFxuICAgICAgICAgICAgaXNOZXdVc2VyOiBtZXNzYWdlLmlzTmV3VXNlciA/PyBmYWxzZSxcbiAgICAgICAgICAgIHJvbGVzOiBtZXRhZGF0YT8ucm9sZXMsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICBhd2FpdCByZWNvcmRBdXRoRXZlbnQoe1xuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBvcmdJZDogbWV0YWRhdGE/Lm9yZ2FuaXphdGlvbklkID8/IG51bGwsXG4gICAgICAgICAgZXZlbnRUeXBlOiBcImxvZ2luLnN1Y2Nlc3NcIixcbiAgICAgICAgICBpcEFkZHJlc3M6IGNvbnRleHQ/LmlwQWRkcmVzcyA/PyBudWxsLFxuICAgICAgICAgIGdlb0NvdW50cnk6IGNvbnRleHQ/Lmdlb0NvdW50cnkgPz8gbnVsbCxcbiAgICAgICAgICB1c2VyQWdlbnQ6IGNvbnRleHQ/LnVzZXJBZ2VudCA/PyBudWxsLFxuICAgICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgICBwcm92aWRlcjogbWVzc2FnZS5hY2NvdW50Py5wcm92aWRlcixcbiAgICAgICAgICAgIGlzTmV3VXNlcjogbWVzc2FnZS5pc05ld1VzZXIgPz8gZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcmVjb3JkIHNpZ24taW4gYXVkaXRcIiwgZXJyb3IpXG4gICAgICB9XG4gICAgfSxcbiAgICBhc3luYyBzaWduT3V0KHsgdG9rZW4gfSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbklkID0gKHRva2VuLnNlc3Npb25JZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQpID8/IHVuZGVmaW5lZFxuICAgICAgICBjb25zdCB1c2VySWQgPSAodG9rZW4udXNlcklkIGFzIHN0cmluZyB8IHVuZGVmaW5lZCkgPz8gdW5kZWZpbmVkXG4gICAgICAgIGNvbnN0IG9yZ0lkID0gKHRva2VuLm9yZ0lkIGFzIHN0cmluZyB8IHVuZGVmaW5lZCkgPz8gdW5kZWZpbmVkXG5cbiAgICAgICAgaWYgKHNlc3Npb25JZCkge1xuICAgICAgICAgIGF3YWl0IGVuZFVzZXJTZXNzaW9uKHNlc3Npb25JZClcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1c2VySWQpIHtcbiAgICAgICAgICBhd2FpdCByZWNvcmRBdXRoRXZlbnQoe1xuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgb3JnSWQsXG4gICAgICAgICAgICBldmVudFR5cGU6IFwibG9nb3V0XCIsXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byByZWNvcmQgc2lnbi1vdXQgYXVkaXRcIiwgZXJyb3IpXG4gICAgICB9XG4gICAgfSxcbiAgICBhc3luYyBzZXNzaW9uKHsgdG9rZW4gfSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbklkID0gdG9rZW4uc2Vzc2lvbklkIGFzIHN0cmluZyB8IHVuZGVmaW5lZFxuICAgICAgICBpZiAoc2Vzc2lvbklkKSB7XG4gICAgICAgICAgYXdhaXQgdG91Y2hVc2VyU2Vzc2lvbihzZXNzaW9uSWQpXG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gcmVjb3JkIHNlc3Npb24gaGVhcnRiZWF0XCIsIGVycm9yKVxuICAgICAgfVxuICAgIH0sXG4gIH0sXG4gIHBhZ2VzOiB7XG4gICAgc2lnbkluOiBcIi9hdXRoL3NpZ24taW5cIixcbiAgfSxcbn1cbiJdLCJuYW1lcyI6WyJyYW5kb21VVUlEIiwiQXV0aDBQcm92aWRlciIsIkNyZWRlbnRpYWxzUHJvdmlkZXIiLCJyZWNvcmRBdXRoRXZlbnQiLCJlbmRVc2VyU2Vzc2lvbiIsImVuc3VyZU1lbWJlcnNoaXAiLCJlbnN1cmVPcmdhbml6YXRpb24iLCJlbnN1cmVVc2VyIiwiZ2V0TWVtYmVyc2hpcCIsImdldFVzZXJCeUF1dGhQcm92aWRlciIsInJlY29yZFVzZXJTZXNzaW9uIiwidG91Y2hVc2VyU2Vzc2lvbiIsImNvbGxlY3RVc2VyUGVybWlzc2lvbnMiLCJERUZBVUxUX1JPTEUiLCJnZXRBdXRoUmVxdWVzdENvbnRleHQiLCJzZXRBdXRoUmVxdWVzdE1ldGFkYXRhIiwiTUVNQkVSU0hJUF9SRUZSRVNIX0lOVEVSVkFMX01TIiwiYXV0aDBEb21haW4iLCJwcm9jZXNzIiwiZW52IiwiQVVUSDBfSVNTVUVSX0JBU0VfVVJMIiwiYXV0aDBDbGllbnRJZCIsIkFVVEgwX0NMSUVOVF9JRCIsImF1dGgwQ2xpZW50U2VjcmV0IiwiQVVUSDBfQ0xJRU5UX1NFQ1JFVCIsImRldkF1dGhFbmFibGVkIiwiREVWX0FVVEhfRU5BQkxFRCIsImRldlVzZXJSb2xlcyIsIkRFVl9BVVRIX1JPTEVTIiwic3BsaXQiLCJtYXAiLCJyb2xlIiwidHJpbSIsImZpbHRlciIsIkJvb2xlYW4iLCJkZXZVc2VyT3JnSWQiLCJERVZfQVVUSF9PUkdfSUQiLCJhdXRoMFByb3ZpZGVyIiwiY2xpZW50SWQiLCJjbGllbnRTZWNyZXQiLCJpc3N1ZXIiLCJyZXNvbHZlUm9sZXMiLCJwcm9maWxlIiwidXNlciIsInJvbGVDbGFpbSIsImNvbGxlY3RlZCIsIlNldCIsImNsYWltZWRSb2xlcyIsIkFycmF5IiwiaXNBcnJheSIsImFkZCIsInR5cGVkVXNlciIsInJvbGVzIiwiZm9yRWFjaCIsInJlc29sdmVPcmdFeHRlcm5hbElkIiwib3JnQ2xhaW0iLCJmcm9tUHJvZmlsZSIsInVuZGVmaW5lZCIsIm9yZ0lkIiwiZW5zdXJlUm9sZXNQcmVzZW5jZSIsImxlbmd0aCIsImF1dGhPcHRpb25zIiwiZGVidWciLCJORVhUQVVUSF9ERUJVRyIsInNlY3JldCIsIk5FWFRBVVRIX1NFQ1JFVCIsInNlc3Npb24iLCJzdHJhdGVneSIsInByb3ZpZGVycyIsIm5hbWUiLCJjcmVkZW50aWFscyIsImVtYWlsIiwibGFiZWwiLCJ0eXBlIiwiYXV0aG9yaXplIiwiRXJyb3IiLCJpZCIsImNhbGxiYWNrcyIsImp3dCIsInRva2VuIiwiYWNjb3VudCIsInNlc3Npb25JZCIsIkFVVEgwX1JPTEVfQ0xBSU0iLCJBVVRIMF9PUkdfQ0xBSU0iLCJwcm92aWRlckFjY291bnRJZCIsInByb3ZpZGVyIiwic3ViIiwicmVzb2x2ZWRSb2xlcyIsIm9yZ0V4dGVybmFsSWQiLCJyZXNvbHZlZE9yZ0V4dGVybmFsSWQiLCJzdXBhYmFzZVVzZXIiLCJhdXRoMFVzZXJJZCIsImRpc3BsYXlOYW1lIiwibWVtYmVyc2hpcE9yZ0lkIiwiZmluYWxSb2xlcyIsIm9yZ2FuaXphdGlvbiIsImV4dGVybmFsX3JlZiIsIm1lbWJlcnNoaXAiLCJ1c2VySWQiLCJvcmdhbml6YXRpb25JZCIsImFjdG9yVXNlcklkIiwib3JnYW5pemF0aW9uX2lkIiwibWVtYmVyc2hpcFN5bmNlZEF0IiwiRGF0ZSIsIm5vdyIsImNvbnRleHQiLCJnZW9Db3VudHJ5IiwiZXJyb3IiLCJjb25zb2xlIiwibGFzdFN5bmNlZCIsInBlcm1pc3Npb25zIiwiZXZlbnRzIiwic2lnbkluIiwibWVzc2FnZSIsIm1ldGFkYXRhIiwiaXBBZGRyZXNzIiwidXNlckFnZW50IiwiaXNOZXdVc2VyIiwiZXZlbnRUeXBlIiwic2lnbk91dCIsInBhZ2VzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/options.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/request-context.ts":
/*!*************************************!*\
  !*** ./lib/auth/request-context.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAuthRequestContext: () => (/* binding */ getAuthRequestContext),\n/* harmony export */   runWithAuthRequestContext: () => (/* binding */ runWithAuthRequestContext),\n/* harmony export */   setAuthRequestMetadata: () => (/* binding */ setAuthRequestMetadata)\n/* harmony export */ });\n/* harmony import */ var async_hooks__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! async_hooks */ \"async_hooks\");\n/* harmony import */ var async_hooks__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(async_hooks__WEBPACK_IMPORTED_MODULE_0__);\n\nconst authContextStorage = new async_hooks__WEBPACK_IMPORTED_MODULE_0__.AsyncLocalStorage();\nfunction runWithAuthRequestContext(context, callback) {\n    const ctx = {\n        ...context,\n        metadata: context.metadata ?? {}\n    };\n    return authContextStorage.run(ctx, callback);\n}\nfunction getAuthRequestContext() {\n    return authContextStorage.getStore();\n}\nfunction setAuthRequestMetadata(partial) {\n    const context = authContextStorage.getStore();\n    if (!context) return;\n    context.metadata = {\n        ...context.metadata,\n        ...partial\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9yZXF1ZXN0LWNvbnRleHQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBK0M7QUFvQi9DLE1BQU1DLHFCQUFxQixJQUFJRCwwREFBaUJBO0FBRXpDLFNBQVNFLDBCQUNkQyxPQUFrRixFQUNsRkMsUUFBaUI7SUFFakIsTUFBTUMsTUFBMEI7UUFDOUIsR0FBR0YsT0FBTztRQUNWRyxVQUFVSCxRQUFRRyxRQUFRLElBQUksQ0FBQztJQUNqQztJQUNBLE9BQU9MLG1CQUFtQk0sR0FBRyxDQUFDRixLQUFLRDtBQUNyQztBQUVPLFNBQVNJO0lBQ2QsT0FBT1AsbUJBQW1CUSxRQUFRO0FBQ3BDO0FBRU8sU0FBU0MsdUJBQXVCQyxPQUE0QjtJQUNqRSxNQUFNUixVQUFVRixtQkFBbUJRLFFBQVE7SUFDM0MsSUFBSSxDQUFDTixTQUFTO0lBQ2RBLFFBQVFHLFFBQVEsR0FBRztRQUNqQixHQUFHSCxRQUFRRyxRQUFRO1FBQ25CLEdBQUdLLE9BQU87SUFDWjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2xpYi9hdXRoL3JlcXVlc3QtY29udGV4dC50cz81MTE1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFzeW5jTG9jYWxTdG9yYWdlIH0gZnJvbSBcImFzeW5jX2hvb2tzXCJcbmltcG9ydCB7IE5leHRSZXF1ZXN0IH0gZnJvbSBcIm5leHQvc2VydmVyXCJcblxuZXhwb3J0IGludGVyZmFjZSBBdXRoUmVxdWVzdE1ldGFkYXRhIHtcbiAgc2Vzc2lvbklkPzogc3RyaW5nXG4gIHVzZXJJZD86IHN0cmluZ1xuICBvcmdhbml6YXRpb25JZD86IHN0cmluZ1xuICBvcmdFeHRlcm5hbElkPzogc3RyaW5nXG4gIHJvbGVzPzogc3RyaW5nW11cbiAgZ2VvQ291bnRyeT86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhSZXF1ZXN0Q29udGV4dCB7XG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0XG4gIGlwQWRkcmVzcz86IHN0cmluZ1xuICB1c2VyQWdlbnQ/OiBzdHJpbmdcbiAgZ2VvQ291bnRyeT86IHN0cmluZ1xuICBtZXRhZGF0YTogQXV0aFJlcXVlc3RNZXRhZGF0YVxufVxuXG5jb25zdCBhdXRoQ29udGV4dFN0b3JhZ2UgPSBuZXcgQXN5bmNMb2NhbFN0b3JhZ2U8QXV0aFJlcXVlc3RDb250ZXh0PigpXG5cbmV4cG9ydCBmdW5jdGlvbiBydW5XaXRoQXV0aFJlcXVlc3RDb250ZXh0PFQ+KFxuICBjb250ZXh0OiBPbWl0PEF1dGhSZXF1ZXN0Q29udGV4dCwgXCJtZXRhZGF0YVwiPiAmIHsgbWV0YWRhdGE/OiBBdXRoUmVxdWVzdE1ldGFkYXRhIH0sXG4gIGNhbGxiYWNrOiAoKSA9PiBUXG4pOiBUIHtcbiAgY29uc3QgY3R4OiBBdXRoUmVxdWVzdENvbnRleHQgPSB7XG4gICAgLi4uY29udGV4dCxcbiAgICBtZXRhZGF0YTogY29udGV4dC5tZXRhZGF0YSA/PyB7fSxcbiAgfVxuICByZXR1cm4gYXV0aENvbnRleHRTdG9yYWdlLnJ1bihjdHgsIGNhbGxiYWNrKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXV0aFJlcXVlc3RDb250ZXh0KCk6IEF1dGhSZXF1ZXN0Q29udGV4dCB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiBhdXRoQ29udGV4dFN0b3JhZ2UuZ2V0U3RvcmUoKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0QXV0aFJlcXVlc3RNZXRhZGF0YShwYXJ0aWFsOiBBdXRoUmVxdWVzdE1ldGFkYXRhKSB7XG4gIGNvbnN0IGNvbnRleHQgPSBhdXRoQ29udGV4dFN0b3JhZ2UuZ2V0U3RvcmUoKVxuICBpZiAoIWNvbnRleHQpIHJldHVyblxuICBjb250ZXh0Lm1ldGFkYXRhID0ge1xuICAgIC4uLmNvbnRleHQubWV0YWRhdGEsXG4gICAgLi4ucGFydGlhbCxcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkFzeW5jTG9jYWxTdG9yYWdlIiwiYXV0aENvbnRleHRTdG9yYWdlIiwicnVuV2l0aEF1dGhSZXF1ZXN0Q29udGV4dCIsImNvbnRleHQiLCJjYWxsYmFjayIsImN0eCIsIm1ldGFkYXRhIiwicnVuIiwiZ2V0QXV0aFJlcXVlc3RDb250ZXh0IiwiZ2V0U3RvcmUiLCJzZXRBdXRoUmVxdWVzdE1ldGFkYXRhIiwicGFydGlhbCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/request-context.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth/store.ts":
/*!***************************!*\
  !*** ./lib/auth/store.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   endUserSession: () => (/* binding */ endUserSession),\n/* harmony export */   ensureMembership: () => (/* binding */ ensureMembership),\n/* harmony export */   ensureOrganization: () => (/* binding */ ensureOrganization),\n/* harmony export */   ensureUser: () => (/* binding */ ensureUser),\n/* harmony export */   getMembership: () => (/* binding */ getMembership),\n/* harmony export */   getUserByAuthProvider: () => (/* binding */ getUserByAuthProvider),\n/* harmony export */   recordUserSession: () => (/* binding */ recordUserSession),\n/* harmony export */   touchUserSession: () => (/* binding */ touchUserSession)\n/* harmony export */ });\n/* harmony import */ var _lib_auth_audit__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/auth/audit */ \"(rsc)/./lib/auth/audit.ts\");\n/* harmony import */ var _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db/supabase */ \"(rsc)/./lib/db/supabase.ts\");\n\n\nasync function ensureOrganization(externalId, name) {\n    if (!externalId) {\n        throw new Error(\"Missing external organization identifier\");\n    }\n    const { data: existing, error: selectError } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"organizations\").select().eq(\"external_ref\", externalId).maybeSingle();\n    if (selectError) {\n        throw new Error(`Failed to fetch organization: ${selectError.message}`);\n    }\n    if (existing) {\n        if (name && existing.name !== name) {\n            const { data: updated, error: updateError } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"organizations\").update({\n                name\n            }).eq(\"id\", existing.id).select().single();\n            if (updateError || !updated) {\n                throw new Error(`Failed to update organization: ${updateError?.message ?? \"no data\"}`);\n            }\n            return updated;\n        }\n        return existing;\n    }\n    const { data: inserted, error: insertError } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"organizations\").insert({\n        external_ref: externalId,\n        name: name ?? externalId\n    }).select().single();\n    if (insertError || !inserted) {\n        throw new Error(`Failed to insert organization: ${insertError?.message ?? \"no data\"}`);\n    }\n    return inserted;\n}\nasync function ensureUser(params) {\n    const { auth0UserId, email, displayName } = params;\n    const { data, error } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"users\").upsert({\n        auth0_user_id: auth0UserId,\n        email: email ?? null,\n        display_name: displayName ?? null\n    }, {\n        onConflict: \"auth0_user_id\"\n    }).select().single();\n    if (error || !data) {\n        throw new Error(`Failed to upsert user: ${error?.message ?? \"no data\"}`);\n    }\n    return data;\n}\nasync function ensureMembership(params) {\n    const { data: existing, error: selectError } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"user_organization_memberships\").select().match({\n        user_id: params.userId,\n        organization_id: params.organizationId\n    }).maybeSingle();\n    if (selectError) {\n        throw new Error(`Failed to fetch membership: ${selectError.message}`);\n    }\n    if (existing) {\n        if (Array.isArray(existing.roles) && arraysEqual(existing.roles, params.roles)) {\n            return existing;\n        }\n        const { data: updated, error: updateError } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"user_organization_memberships\").update({\n            roles: params.roles\n        }).match({\n            user_id: params.userId,\n            organization_id: params.organizationId\n        }).select().single();\n        if (updateError || !updated) {\n            throw new Error(`Failed to update membership: ${updateError?.message ?? \"no data\"}`);\n        }\n        await (0,_lib_auth_audit__WEBPACK_IMPORTED_MODULE_0__.recordAuthEvent)({\n            userId: params.actorUserId ?? params.userId,\n            orgId: params.organizationId,\n            eventType: \"rbac.roles.updated\",\n            metadata: {\n                targetUserId: params.userId,\n                previousRoles: existing.roles ?? [],\n                nextRoles: params.roles\n            }\n        });\n        return updated;\n    }\n    const { data: inserted, error: insertError } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"user_organization_memberships\").insert({\n        user_id: params.userId,\n        organization_id: params.organizationId,\n        roles: params.roles\n    }).select().single();\n    if (insertError || !inserted) {\n        throw new Error(`Failed to insert membership: ${insertError?.message ?? \"no data\"}`);\n    }\n    await (0,_lib_auth_audit__WEBPACK_IMPORTED_MODULE_0__.recordAuthEvent)({\n        userId: params.actorUserId ?? params.userId,\n        orgId: params.organizationId,\n        eventType: \"rbac.roles.created\",\n        metadata: {\n            targetUserId: params.userId,\n            nextRoles: params.roles\n        }\n    });\n    return inserted;\n}\nasync function getMembership(userId, organizationId) {\n    const { data, error } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"user_organization_memberships\").select().match({\n        user_id: userId,\n        organization_id: organizationId\n    }).maybeSingle();\n    if (error) {\n        throw new Error(`Failed to fetch membership: ${error.message}`);\n    }\n    return data ?? null;\n}\nasync function getUserByAuthProvider(auth0UserId) {\n    const { data, error } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"users\").select().eq(\"auth0_user_id\", auth0UserId).maybeSingle();\n    if (error) {\n        throw new Error(`Failed to fetch user: ${error.message}`);\n    }\n    return data ?? null;\n}\nasync function recordUserSession(params) {\n    const { data, error } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"user_sessions\").upsert({\n        id: params.sessionId,\n        user_id: params.userId,\n        organization_id: params.organizationId ?? null,\n        ip_address: params.ipAddress ?? null,\n        geo_country: params.geoCountry ?? null,\n        user_agent: params.userAgent ?? null,\n        metadata: params.metadata ?? null,\n        expires_at: params.expiresAt ? new Date(params.expiresAt).toISOString() : null,\n        last_seen_at: new Date().toISOString()\n    }, {\n        onConflict: \"id\"\n    }).select().single();\n    if (error || !data) {\n        throw new Error(`Failed to upsert user session: ${error?.message ?? \"no data\"}`);\n    }\n    return data;\n}\nasync function touchUserSession(sessionId) {\n    const { error } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"user_sessions\").update({\n        last_seen_at: new Date().toISOString()\n    }).eq(\"id\", sessionId);\n    if (error) {\n        throw new Error(`Failed to update user session heartbeat: ${error.message}`);\n    }\n}\nasync function endUserSession(sessionId) {\n    const { error } = await _lib_db_supabase__WEBPACK_IMPORTED_MODULE_1__.supabase.from(\"user_sessions\").update({\n        ended_at: new Date().toISOString()\n    }).eq(\"id\", sessionId);\n    if (error) {\n        throw new Error(`Failed to end user session: ${error.message}`);\n    }\n}\nfunction arraysEqual(a, b) {\n    if (!a && !b) return true;\n    if (!a || !b) return false;\n    if (a.length !== b.length) return false;\n    const sortedA = [\n        ...a\n    ].sort();\n    const sortedB = [\n        ...b\n    ].sort();\n    return sortedA.every((value, index)=>value === sortedB[index]);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC9zdG9yZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQWtEO0FBQ047QUEyQ3JDLGVBQWVFLG1CQUFtQkMsVUFBa0IsRUFBRUMsSUFBYTtJQUN4RSxJQUFJLENBQUNELFlBQVk7UUFDZixNQUFNLElBQUlFLE1BQU07SUFDbEI7SUFFQSxNQUFNLEVBQUVDLE1BQU1DLFFBQVEsRUFBRUMsT0FBT0MsV0FBVyxFQUFFLEdBQUcsTUFBTVIsc0RBQVFBLENBQzFEUyxJQUFJLENBQUMsaUJBQ0xDLE1BQU0sR0FDTkMsRUFBRSxDQUFDLGdCQUFnQlQsWUFDbkJVLFdBQVc7SUFFZCxJQUFJSixhQUFhO1FBQ2YsTUFBTSxJQUFJSixNQUFNLENBQUMsOEJBQThCLEVBQUVJLFlBQVlLLE9BQU8sQ0FBQyxDQUFDO0lBQ3hFO0lBRUEsSUFBSVAsVUFBVTtRQUNaLElBQUlILFFBQVFHLFNBQVNILElBQUksS0FBS0EsTUFBTTtZQUNsQyxNQUFNLEVBQUVFLE1BQU1TLE9BQU8sRUFBRVAsT0FBT1EsV0FBVyxFQUFFLEdBQUcsTUFBTWYsc0RBQVFBLENBQ3pEUyxJQUFJLENBQUMsaUJBQ0xPLE1BQU0sQ0FBQztnQkFBRWI7WUFBSyxHQUNkUSxFQUFFLENBQUMsTUFBTUwsU0FBU1csRUFBRSxFQUNwQlAsTUFBTSxHQUNOUSxNQUFNO1lBRVQsSUFBSUgsZUFBZSxDQUFDRCxTQUFTO2dCQUMzQixNQUFNLElBQUlWLE1BQU0sQ0FBQywrQkFBK0IsRUFBRVcsYUFBYUYsV0FBVyxVQUFVLENBQUM7WUFDdkY7WUFFQSxPQUFPQztRQUNUO1FBRUEsT0FBT1I7SUFDVDtJQUVBLE1BQU0sRUFBRUQsTUFBTWMsUUFBUSxFQUFFWixPQUFPYSxXQUFXLEVBQUUsR0FBRyxNQUFNcEIsc0RBQVFBLENBQzFEUyxJQUFJLENBQUMsaUJBQ0xZLE1BQU0sQ0FBQztRQUNOQyxjQUFjcEI7UUFDZEMsTUFBTUEsUUFBUUQ7SUFDaEIsR0FDQ1EsTUFBTSxHQUNOUSxNQUFNO0lBRVQsSUFBSUUsZUFBZSxDQUFDRCxVQUFVO1FBQzVCLE1BQU0sSUFBSWYsTUFBTSxDQUFDLCtCQUErQixFQUFFZ0IsYUFBYVAsV0FBVyxVQUFVLENBQUM7SUFDdkY7SUFFQSxPQUFPTTtBQUNUO0FBRU8sZUFBZUksV0FBV0MsTUFJaEM7SUFDQyxNQUFNLEVBQUVDLFdBQVcsRUFBRUMsS0FBSyxFQUFFQyxXQUFXLEVBQUUsR0FBR0g7SUFDNUMsTUFBTSxFQUFFbkIsSUFBSSxFQUFFRSxLQUFLLEVBQUUsR0FBRyxNQUFNUCxzREFBUUEsQ0FDbkNTLElBQUksQ0FBQyxTQUNMbUIsTUFBTSxDQUNMO1FBQ0VDLGVBQWVKO1FBQ2ZDLE9BQU9BLFNBQVM7UUFDaEJJLGNBQWNILGVBQWU7SUFDL0IsR0FDQTtRQUFFSSxZQUFZO0lBQWdCLEdBRS9CckIsTUFBTSxHQUNOUSxNQUFNO0lBRVQsSUFBSVgsU0FBUyxDQUFDRixNQUFNO1FBQ2xCLE1BQU0sSUFBSUQsTUFBTSxDQUFDLHVCQUF1QixFQUFFRyxPQUFPTSxXQUFXLFVBQVUsQ0FBQztJQUN6RTtJQUVBLE9BQU9SO0FBQ1Q7QUFFTyxlQUFlMkIsaUJBQWlCUixNQUt0QztJQUNDLE1BQU0sRUFBRW5CLE1BQU1DLFFBQVEsRUFBRUMsT0FBT0MsV0FBVyxFQUFFLEdBQUcsTUFBTVIsc0RBQVFBLENBQzFEUyxJQUFJLENBQUMsaUNBQ0xDLE1BQU0sR0FDTnVCLEtBQUssQ0FBQztRQUFFQyxTQUFTVixPQUFPVyxNQUFNO1FBQUVDLGlCQUFpQlosT0FBT2EsY0FBYztJQUFDLEdBQ3ZFekIsV0FBVztJQUVkLElBQUlKLGFBQWE7UUFDZixNQUFNLElBQUlKLE1BQU0sQ0FBQyw0QkFBNEIsRUFBRUksWUFBWUssT0FBTyxDQUFDLENBQUM7SUFDdEU7SUFFQSxJQUFJUCxVQUFVO1FBQ1osSUFBSWdDLE1BQU1DLE9BQU8sQ0FBQ2pDLFNBQVNrQyxLQUFLLEtBQUtDLFlBQVluQyxTQUFTa0MsS0FBSyxFQUFFaEIsT0FBT2dCLEtBQUssR0FBRztZQUM5RSxPQUFPbEM7UUFDVDtRQUVBLE1BQU0sRUFBRUQsTUFBTVMsT0FBTyxFQUFFUCxPQUFPUSxXQUFXLEVBQUUsR0FBRyxNQUFNZixzREFBUUEsQ0FDekRTLElBQUksQ0FBQyxpQ0FDTE8sTUFBTSxDQUFDO1lBQUV3QixPQUFPaEIsT0FBT2dCLEtBQUs7UUFBQyxHQUM3QlAsS0FBSyxDQUFDO1lBQUVDLFNBQVNWLE9BQU9XLE1BQU07WUFBRUMsaUJBQWlCWixPQUFPYSxjQUFjO1FBQUMsR0FDdkUzQixNQUFNLEdBQ05RLE1BQU07UUFFVCxJQUFJSCxlQUFlLENBQUNELFNBQVM7WUFDM0IsTUFBTSxJQUFJVixNQUFNLENBQUMsNkJBQTZCLEVBQUVXLGFBQWFGLFdBQVcsVUFBVSxDQUFDO1FBQ3JGO1FBRUEsTUFBTWQsZ0VBQWVBLENBQUM7WUFDcEJvQyxRQUFRWCxPQUFPa0IsV0FBVyxJQUFJbEIsT0FBT1csTUFBTTtZQUMzQ1EsT0FBT25CLE9BQU9hLGNBQWM7WUFDNUJPLFdBQVc7WUFDWEMsVUFBVTtnQkFDUkMsY0FBY3RCLE9BQU9XLE1BQU07Z0JBQzNCWSxlQUFlekMsU0FBU2tDLEtBQUssSUFBSSxFQUFFO2dCQUNuQ1EsV0FBV3hCLE9BQU9nQixLQUFLO1lBQ3pCO1FBQ0Y7UUFFQSxPQUFPMUI7SUFDVDtJQUVBLE1BQU0sRUFBRVQsTUFBTWMsUUFBUSxFQUFFWixPQUFPYSxXQUFXLEVBQUUsR0FBRyxNQUFNcEIsc0RBQVFBLENBQzFEUyxJQUFJLENBQUMsaUNBQ0xZLE1BQU0sQ0FBQztRQUNOYSxTQUFTVixPQUFPVyxNQUFNO1FBQ3RCQyxpQkFBaUJaLE9BQU9hLGNBQWM7UUFDdENHLE9BQU9oQixPQUFPZ0IsS0FBSztJQUNyQixHQUNDOUIsTUFBTSxHQUNOUSxNQUFNO0lBRVQsSUFBSUUsZUFBZSxDQUFDRCxVQUFVO1FBQzVCLE1BQU0sSUFBSWYsTUFBTSxDQUFDLDZCQUE2QixFQUFFZ0IsYUFBYVAsV0FBVyxVQUFVLENBQUM7SUFDckY7SUFFQSxNQUFNZCxnRUFBZUEsQ0FBQztRQUNwQm9DLFFBQVFYLE9BQU9rQixXQUFXLElBQUlsQixPQUFPVyxNQUFNO1FBQzNDUSxPQUFPbkIsT0FBT2EsY0FBYztRQUM1Qk8sV0FBVztRQUNYQyxVQUFVO1lBQ1JDLGNBQWN0QixPQUFPVyxNQUFNO1lBQzNCYSxXQUFXeEIsT0FBT2dCLEtBQUs7UUFDekI7SUFDRjtJQUVBLE9BQU9yQjtBQUNUO0FBRU8sZUFBZThCLGNBQWNkLE1BQWMsRUFBRUUsY0FBc0I7SUFDeEUsTUFBTSxFQUFFaEMsSUFBSSxFQUFFRSxLQUFLLEVBQUUsR0FBRyxNQUFNUCxzREFBUUEsQ0FDbkNTLElBQUksQ0FBQyxpQ0FDTEMsTUFBTSxHQUNOdUIsS0FBSyxDQUFDO1FBQUVDLFNBQVNDO1FBQVFDLGlCQUFpQkM7SUFBZSxHQUN6RHpCLFdBQVc7SUFFZCxJQUFJTCxPQUFPO1FBQ1QsTUFBTSxJQUFJSCxNQUFNLENBQUMsNEJBQTRCLEVBQUVHLE1BQU1NLE9BQU8sQ0FBQyxDQUFDO0lBQ2hFO0lBRUEsT0FBTyxRQUF1QztBQUNoRDtBQUVPLGVBQWVxQyxzQkFBc0J6QixXQUFtQjtJQUM3RCxNQUFNLEVBQUVwQixJQUFJLEVBQUVFLEtBQUssRUFBRSxHQUFHLE1BQU1QLHNEQUFRQSxDQUNuQ1MsSUFBSSxDQUFDLFNBQ0xDLE1BQU0sR0FDTkMsRUFBRSxDQUFDLGlCQUFpQmMsYUFDcEJiLFdBQVc7SUFFZCxJQUFJTCxPQUFPO1FBQ1QsTUFBTSxJQUFJSCxNQUFNLENBQUMsc0JBQXNCLEVBQUVHLE1BQU1NLE9BQU8sQ0FBQyxDQUFDO0lBQzFEO0lBRUEsT0FBTyxRQUFpQztBQUMxQztBQUVPLGVBQWVzQyxrQkFBa0IzQixNQVN2QztJQUNDLE1BQU0sRUFBRW5CLElBQUksRUFBRUUsS0FBSyxFQUFFLEdBQUcsTUFBTVAsc0RBQVFBLENBQ25DUyxJQUFJLENBQUMsaUJBQ0xtQixNQUFNLENBQ0w7UUFDRVgsSUFBSU8sT0FBTzRCLFNBQVM7UUFDcEJsQixTQUFTVixPQUFPVyxNQUFNO1FBQ3RCQyxpQkFBaUJaLE9BQU9hLGNBQWMsSUFBSTtRQUMxQ2dCLFlBQVk3QixPQUFPOEIsU0FBUyxJQUFJO1FBQ2hDQyxhQUFhL0IsT0FBT2dDLFVBQVUsSUFBSTtRQUNsQ0MsWUFBWWpDLE9BQU9rQyxTQUFTLElBQUk7UUFDaENiLFVBQVVyQixPQUFPcUIsUUFBUSxJQUFJO1FBQzdCYyxZQUFZbkMsT0FBT29DLFNBQVMsR0FBRyxJQUFJQyxLQUFLckMsT0FBT29DLFNBQVMsRUFBRUUsV0FBVyxLQUFLO1FBQzFFQyxjQUFjLElBQUlGLE9BQU9DLFdBQVc7SUFDdEMsR0FDQTtRQUFFL0IsWUFBWTtJQUFLLEdBRXBCckIsTUFBTSxHQUNOUSxNQUFNO0lBRVQsSUFBSVgsU0FBUyxDQUFDRixNQUFNO1FBQ2xCLE1BQU0sSUFBSUQsTUFBTSxDQUFDLCtCQUErQixFQUFFRyxPQUFPTSxXQUFXLFVBQVUsQ0FBQztJQUNqRjtJQUVBLE9BQU9SO0FBQ1Q7QUFFTyxlQUFlMkQsaUJBQWlCWixTQUFpQjtJQUN0RCxNQUFNLEVBQUU3QyxLQUFLLEVBQUUsR0FBRyxNQUFNUCxzREFBUUEsQ0FDN0JTLElBQUksQ0FBQyxpQkFDTE8sTUFBTSxDQUFDO1FBQUUrQyxjQUFjLElBQUlGLE9BQU9DLFdBQVc7SUFBRyxHQUNoRG5ELEVBQUUsQ0FBQyxNQUFNeUM7SUFFWixJQUFJN0MsT0FBTztRQUNULE1BQU0sSUFBSUgsTUFBTSxDQUFDLHlDQUF5QyxFQUFFRyxNQUFNTSxPQUFPLENBQUMsQ0FBQztJQUM3RTtBQUNGO0FBRU8sZUFBZW9ELGVBQWViLFNBQWlCO0lBQ3BELE1BQU0sRUFBRTdDLEtBQUssRUFBRSxHQUFHLE1BQU1QLHNEQUFRQSxDQUM3QlMsSUFBSSxDQUFDLGlCQUNMTyxNQUFNLENBQUM7UUFBRWtELFVBQVUsSUFBSUwsT0FBT0MsV0FBVztJQUFHLEdBQzVDbkQsRUFBRSxDQUFDLE1BQU15QztJQUVaLElBQUk3QyxPQUFPO1FBQ1QsTUFBTSxJQUFJSCxNQUFNLENBQUMsNEJBQTRCLEVBQUVHLE1BQU1NLE9BQU8sQ0FBQyxDQUFDO0lBQ2hFO0FBQ0Y7QUFFQSxTQUFTNEIsWUFBWTBCLENBQVksRUFBRUMsQ0FBWTtJQUM3QyxJQUFJLENBQUNELEtBQUssQ0FBQ0MsR0FBRyxPQUFPO0lBQ3JCLElBQUksQ0FBQ0QsS0FBSyxDQUFDQyxHQUFHLE9BQU87SUFDckIsSUFBSUQsRUFBRUUsTUFBTSxLQUFLRCxFQUFFQyxNQUFNLEVBQUUsT0FBTztJQUNsQyxNQUFNQyxVQUFVO1dBQUlIO0tBQUUsQ0FBQ0ksSUFBSTtJQUMzQixNQUFNQyxVQUFVO1dBQUlKO0tBQUUsQ0FBQ0csSUFBSTtJQUMzQixPQUFPRCxRQUFRRyxLQUFLLENBQUMsQ0FBQ0MsT0FBT0MsUUFBVUQsVUFBVUYsT0FBTyxDQUFDRyxNQUFNO0FBQ2pFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2xpYi9hdXRoL3N0b3JlLnRzP2Q0ODYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVjb3JkQXV0aEV2ZW50IH0gZnJvbSBcIkAvbGliL2F1dGgvYXVkaXRcIlxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tIFwiQC9saWIvZGIvc3VwYWJhc2VcIlxuXG5leHBvcnQgaW50ZXJmYWNlIFN1cGFiYXNlVXNlciB7XG4gIGlkOiBzdHJpbmdcbiAgYXV0aDBfdXNlcl9pZDogc3RyaW5nXG4gIGVtYWlsOiBzdHJpbmdcbiAgZGlzcGxheV9uYW1lOiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRfYXQ/OiBzdHJpbmdcbiAgdXBkYXRlZF9hdD86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN1cGFiYXNlT3JnYW5pemF0aW9uIHtcbiAgaWQ6IHN0cmluZ1xuICBleHRlcm5hbF9yZWY6IHN0cmluZyB8IG51bGxcbiAgbmFtZTogc3RyaW5nXG4gIHNsdWc/OiBzdHJpbmcgfCBudWxsXG4gIGNyZWF0ZWRfYXQ/OiBzdHJpbmdcbiAgdXBkYXRlZF9hdD86IHN0cmluZ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN1cGFiYXNlTWVtYmVyc2hpcCB7XG4gIGlkOiBzdHJpbmdcbiAgdXNlcl9pZDogc3RyaW5nXG4gIG9yZ2FuaXphdGlvbl9pZDogc3RyaW5nXG4gIHJvbGVzOiBzdHJpbmdbXVxuICBjcmVhdGVkX2F0Pzogc3RyaW5nXG4gIHVwZGF0ZWRfYXQ/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTdXBhYmFzZVNlc3Npb25SZWNvcmQge1xuICBpZDogc3RyaW5nXG4gIHVzZXJfaWQ6IHN0cmluZ1xuICBvcmdhbml6YXRpb25faWQ6IHN0cmluZyB8IG51bGxcbiAgaXBfYWRkcmVzczogc3RyaW5nIHwgbnVsbFxuICBnZW9fY291bnRyeTogc3RyaW5nIHwgbnVsbFxuICB1c2VyX2FnZW50OiBzdHJpbmcgfCBudWxsXG4gIG1ldGFkYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB8IG51bGxcbiAgZXhwaXJlc19hdDogc3RyaW5nIHwgbnVsbFxuICBsYXN0X3NlZW5fYXQ6IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICB1cGRhdGVkX2F0Pzogc3RyaW5nXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbnN1cmVPcmdhbml6YXRpb24oZXh0ZXJuYWxJZDogc3RyaW5nLCBuYW1lPzogc3RyaW5nKTogUHJvbWlzZTxTdXBhYmFzZU9yZ2FuaXphdGlvbj4ge1xuICBpZiAoIWV4dGVybmFsSWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGV4dGVybmFsIG9yZ2FuaXphdGlvbiBpZGVudGlmaWVyXCIpXG4gIH1cblxuICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nLCBlcnJvcjogc2VsZWN0RXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oXCJvcmdhbml6YXRpb25zXCIpXG4gICAgLnNlbGVjdCgpXG4gICAgLmVxKFwiZXh0ZXJuYWxfcmVmXCIsIGV4dGVybmFsSWQpXG4gICAgLm1heWJlU2luZ2xlKClcblxuICBpZiAoc2VsZWN0RXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBmZXRjaCBvcmdhbml6YXRpb246ICR7c2VsZWN0RXJyb3IubWVzc2FnZX1gKVxuICB9XG5cbiAgaWYgKGV4aXN0aW5nKSB7XG4gICAgaWYgKG5hbWUgJiYgZXhpc3RpbmcubmFtZSAhPT0gbmFtZSkge1xuICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKFwib3JnYW5pemF0aW9uc1wiKVxuICAgICAgICAudXBkYXRlKHsgbmFtZSB9KVxuICAgICAgICAuZXEoXCJpZFwiLCBleGlzdGluZy5pZClcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKVxuXG4gICAgICBpZiAodXBkYXRlRXJyb3IgfHwgIXVwZGF0ZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gdXBkYXRlIG9yZ2FuaXphdGlvbjogJHt1cGRhdGVFcnJvcj8ubWVzc2FnZSA/PyBcIm5vIGRhdGFcIn1gKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdXBkYXRlZCBhcyBTdXBhYmFzZU9yZ2FuaXphdGlvblxuICAgIH1cblxuICAgIHJldHVybiBleGlzdGluZyBhcyBTdXBhYmFzZU9yZ2FuaXphdGlvblxuICB9XG5cbiAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwib3JnYW5pemF0aW9uc1wiKVxuICAgIC5pbnNlcnQoe1xuICAgICAgZXh0ZXJuYWxfcmVmOiBleHRlcm5hbElkLFxuICAgICAgbmFtZTogbmFtZSA/PyBleHRlcm5hbElkLFxuICAgIH0pXG4gICAgLnNlbGVjdCgpXG4gICAgLnNpbmdsZSgpXG5cbiAgaWYgKGluc2VydEVycm9yIHx8ICFpbnNlcnRlZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGluc2VydCBvcmdhbml6YXRpb246ICR7aW5zZXJ0RXJyb3I/Lm1lc3NhZ2UgPz8gXCJubyBkYXRhXCJ9YClcbiAgfVxuXG4gIHJldHVybiBpbnNlcnRlZCBhcyBTdXBhYmFzZU9yZ2FuaXphdGlvblxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZW5zdXJlVXNlcihwYXJhbXM6IHtcbiAgYXV0aDBVc2VySWQ6IHN0cmluZ1xuICBlbWFpbD86IHN0cmluZyB8IG51bGxcbiAgZGlzcGxheU5hbWU/OiBzdHJpbmcgfCBudWxsXG59KTogUHJvbWlzZTxTdXBhYmFzZVVzZXI+IHtcbiAgY29uc3QgeyBhdXRoMFVzZXJJZCwgZW1haWwsIGRpc3BsYXlOYW1lIH0gPSBwYXJhbXNcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbShcInVzZXJzXCIpXG4gICAgLnVwc2VydChcbiAgICAgIHtcbiAgICAgICAgYXV0aDBfdXNlcl9pZDogYXV0aDBVc2VySWQsXG4gICAgICAgIGVtYWlsOiBlbWFpbCA/PyBudWxsLFxuICAgICAgICBkaXNwbGF5X25hbWU6IGRpc3BsYXlOYW1lID8/IG51bGwsXG4gICAgICB9LFxuICAgICAgeyBvbkNvbmZsaWN0OiBcImF1dGgwX3VzZXJfaWRcIiB9XG4gICAgKVxuICAgIC5zZWxlY3QoKVxuICAgIC5zaW5nbGUoKVxuXG4gIGlmIChlcnJvciB8fCAhZGF0YSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHVwc2VydCB1c2VyOiAke2Vycm9yPy5tZXNzYWdlID8/IFwibm8gZGF0YVwifWApXG4gIH1cblxuICByZXR1cm4gZGF0YSBhcyBTdXBhYmFzZVVzZXJcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuc3VyZU1lbWJlcnNoaXAocGFyYW1zOiB7XG4gIHVzZXJJZDogc3RyaW5nXG4gIG9yZ2FuaXphdGlvbklkOiBzdHJpbmdcbiAgcm9sZXM6IHN0cmluZ1tdXG4gIGFjdG9yVXNlcklkPzogc3RyaW5nXG59KTogUHJvbWlzZTxTdXBhYmFzZU1lbWJlcnNoaXA+IHtcbiAgY29uc3QgeyBkYXRhOiBleGlzdGluZywgZXJyb3I6IHNlbGVjdEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwidXNlcl9vcmdhbml6YXRpb25fbWVtYmVyc2hpcHNcIilcbiAgICAuc2VsZWN0KClcbiAgICAubWF0Y2goeyB1c2VyX2lkOiBwYXJhbXMudXNlcklkLCBvcmdhbml6YXRpb25faWQ6IHBhcmFtcy5vcmdhbml6YXRpb25JZCB9KVxuICAgIC5tYXliZVNpbmdsZSgpXG5cbiAgaWYgKHNlbGVjdEVycm9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggbWVtYmVyc2hpcDogJHtzZWxlY3RFcnJvci5tZXNzYWdlfWApXG4gIH1cblxuICBpZiAoZXhpc3RpbmcpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShleGlzdGluZy5yb2xlcykgJiYgYXJyYXlzRXF1YWwoZXhpc3Rpbmcucm9sZXMsIHBhcmFtcy5yb2xlcykpIHtcbiAgICAgIHJldHVybiBleGlzdGluZyBhcyBTdXBhYmFzZU1lbWJlcnNoaXBcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWQsIGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKFwidXNlcl9vcmdhbml6YXRpb25fbWVtYmVyc2hpcHNcIilcbiAgICAgIC51cGRhdGUoeyByb2xlczogcGFyYW1zLnJvbGVzIH0pXG4gICAgICAubWF0Y2goeyB1c2VyX2lkOiBwYXJhbXMudXNlcklkLCBvcmdhbml6YXRpb25faWQ6IHBhcmFtcy5vcmdhbml6YXRpb25JZCB9KVxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmICh1cGRhdGVFcnJvciB8fCAhdXBkYXRlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gdXBkYXRlIG1lbWJlcnNoaXA6ICR7dXBkYXRlRXJyb3I/Lm1lc3NhZ2UgPz8gXCJubyBkYXRhXCJ9YClcbiAgICB9XG5cbiAgICBhd2FpdCByZWNvcmRBdXRoRXZlbnQoe1xuICAgICAgdXNlcklkOiBwYXJhbXMuYWN0b3JVc2VySWQgPz8gcGFyYW1zLnVzZXJJZCxcbiAgICAgIG9yZ0lkOiBwYXJhbXMub3JnYW5pemF0aW9uSWQsXG4gICAgICBldmVudFR5cGU6IFwicmJhYy5yb2xlcy51cGRhdGVkXCIsXG4gICAgICBtZXRhZGF0YToge1xuICAgICAgICB0YXJnZXRVc2VySWQ6IHBhcmFtcy51c2VySWQsXG4gICAgICAgIHByZXZpb3VzUm9sZXM6IGV4aXN0aW5nLnJvbGVzID8/IFtdLFxuICAgICAgICBuZXh0Um9sZXM6IHBhcmFtcy5yb2xlcyxcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIHJldHVybiB1cGRhdGVkIGFzIFN1cGFiYXNlTWVtYmVyc2hpcFxuICB9XG5cbiAgY29uc3QgeyBkYXRhOiBpbnNlcnRlZCwgZXJyb3I6IGluc2VydEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwidXNlcl9vcmdhbml6YXRpb25fbWVtYmVyc2hpcHNcIilcbiAgICAuaW5zZXJ0KHtcbiAgICAgIHVzZXJfaWQ6IHBhcmFtcy51c2VySWQsXG4gICAgICBvcmdhbml6YXRpb25faWQ6IHBhcmFtcy5vcmdhbml6YXRpb25JZCxcbiAgICAgIHJvbGVzOiBwYXJhbXMucm9sZXMsXG4gICAgfSlcbiAgICAuc2VsZWN0KClcbiAgICAuc2luZ2xlKClcblxuICBpZiAoaW5zZXJ0RXJyb3IgfHwgIWluc2VydGVkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gaW5zZXJ0IG1lbWJlcnNoaXA6ICR7aW5zZXJ0RXJyb3I/Lm1lc3NhZ2UgPz8gXCJubyBkYXRhXCJ9YClcbiAgfVxuXG4gIGF3YWl0IHJlY29yZEF1dGhFdmVudCh7XG4gICAgdXNlcklkOiBwYXJhbXMuYWN0b3JVc2VySWQgPz8gcGFyYW1zLnVzZXJJZCxcbiAgICBvcmdJZDogcGFyYW1zLm9yZ2FuaXphdGlvbklkLFxuICAgIGV2ZW50VHlwZTogXCJyYmFjLnJvbGVzLmNyZWF0ZWRcIixcbiAgICBtZXRhZGF0YToge1xuICAgICAgdGFyZ2V0VXNlcklkOiBwYXJhbXMudXNlcklkLFxuICAgICAgbmV4dFJvbGVzOiBwYXJhbXMucm9sZXMsXG4gICAgfSxcbiAgfSlcblxuICByZXR1cm4gaW5zZXJ0ZWQgYXMgU3VwYWJhc2VNZW1iZXJzaGlwXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRNZW1iZXJzaGlwKHVzZXJJZDogc3RyaW5nLCBvcmdhbml6YXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxTdXBhYmFzZU1lbWJlcnNoaXAgfCBudWxsPiB7XG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oXCJ1c2VyX29yZ2FuaXphdGlvbl9tZW1iZXJzaGlwc1wiKVxuICAgIC5zZWxlY3QoKVxuICAgIC5tYXRjaCh7IHVzZXJfaWQ6IHVzZXJJZCwgb3JnYW5pemF0aW9uX2lkOiBvcmdhbml6YXRpb25JZCB9KVxuICAgIC5tYXliZVNpbmdsZSgpXG5cbiAgaWYgKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggbWVtYmVyc2hpcDogJHtlcnJvci5tZXNzYWdlfWApXG4gIH1cblxuICByZXR1cm4gKGRhdGEgYXMgU3VwYWJhc2VNZW1iZXJzaGlwIHwgbnVsbCkgPz8gbnVsbFxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckJ5QXV0aFByb3ZpZGVyKGF1dGgwVXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFN1cGFiYXNlVXNlciB8IG51bGw+IHtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbShcInVzZXJzXCIpXG4gICAgLnNlbGVjdCgpXG4gICAgLmVxKFwiYXV0aDBfdXNlcl9pZFwiLCBhdXRoMFVzZXJJZClcbiAgICAubWF5YmVTaW5nbGUoKVxuXG4gIGlmIChlcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIHVzZXI6ICR7ZXJyb3IubWVzc2FnZX1gKVxuICB9XG5cbiAgcmV0dXJuIChkYXRhIGFzIFN1cGFiYXNlVXNlciB8IG51bGwpID8/IG51bGxcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlY29yZFVzZXJTZXNzaW9uKHBhcmFtczoge1xuICBzZXNzaW9uSWQ6IHN0cmluZ1xuICB1c2VySWQ6IHN0cmluZ1xuICBvcmdhbml6YXRpb25JZD86IHN0cmluZyB8IG51bGxcbiAgaXBBZGRyZXNzPzogc3RyaW5nIHwgbnVsbFxuICBnZW9Db3VudHJ5Pzogc3RyaW5nIHwgbnVsbFxuICB1c2VyQWdlbnQ/OiBzdHJpbmcgfCBudWxsXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbiAgZXhwaXJlc0F0PzogRGF0ZSB8IHN0cmluZyB8IG51bGxcbn0pOiBQcm9taXNlPFN1cGFiYXNlU2Vzc2lvblJlY29yZD4ge1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwidXNlcl9zZXNzaW9uc1wiKVxuICAgIC51cHNlcnQoXG4gICAgICB7XG4gICAgICAgIGlkOiBwYXJhbXMuc2Vzc2lvbklkLFxuICAgICAgICB1c2VyX2lkOiBwYXJhbXMudXNlcklkLFxuICAgICAgICBvcmdhbml6YXRpb25faWQ6IHBhcmFtcy5vcmdhbml6YXRpb25JZCA/PyBudWxsLFxuICAgICAgICBpcF9hZGRyZXNzOiBwYXJhbXMuaXBBZGRyZXNzID8/IG51bGwsXG4gICAgICAgIGdlb19jb3VudHJ5OiBwYXJhbXMuZ2VvQ291bnRyeSA/PyBudWxsLFxuICAgICAgICB1c2VyX2FnZW50OiBwYXJhbXMudXNlckFnZW50ID8/IG51bGwsXG4gICAgICAgIG1ldGFkYXRhOiBwYXJhbXMubWV0YWRhdGEgPz8gbnVsbCxcbiAgICAgICAgZXhwaXJlc19hdDogcGFyYW1zLmV4cGlyZXNBdCA/IG5ldyBEYXRlKHBhcmFtcy5leHBpcmVzQXQpLnRvSVNPU3RyaW5nKCkgOiBudWxsLFxuICAgICAgICBsYXN0X3NlZW5fYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH0sXG4gICAgICB7IG9uQ29uZmxpY3Q6IFwiaWRcIiB9XG4gICAgKVxuICAgIC5zZWxlY3QoKVxuICAgIC5zaW5nbGUoKVxuXG4gIGlmIChlcnJvciB8fCAhZGF0YSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHVwc2VydCB1c2VyIHNlc3Npb246ICR7ZXJyb3I/Lm1lc3NhZ2UgPz8gXCJubyBkYXRhXCJ9YClcbiAgfVxuXG4gIHJldHVybiBkYXRhIGFzIFN1cGFiYXNlU2Vzc2lvblJlY29yZFxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdG91Y2hVc2VyU2Vzc2lvbihzZXNzaW9uSWQ6IHN0cmluZykge1xuICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwidXNlcl9zZXNzaW9uc1wiKVxuICAgIC51cGRhdGUoeyBsYXN0X3NlZW5fYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9KVxuICAgIC5lcShcImlkXCIsIHNlc3Npb25JZClcblxuICBpZiAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byB1cGRhdGUgdXNlciBzZXNzaW9uIGhlYXJ0YmVhdDogJHtlcnJvci5tZXNzYWdlfWApXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVuZFVzZXJTZXNzaW9uKHNlc3Npb25JZDogc3RyaW5nKSB7XG4gIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oXCJ1c2VyX3Nlc3Npb25zXCIpXG4gICAgLnVwZGF0ZSh7IGVuZGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSlcbiAgICAuZXEoXCJpZFwiLCBzZXNzaW9uSWQpXG5cbiAgaWYgKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZW5kIHVzZXIgc2Vzc2lvbjogJHtlcnJvci5tZXNzYWdlfWApXG4gIH1cbn1cblxuZnVuY3Rpb24gYXJyYXlzRXF1YWwoYT86IHN0cmluZ1tdLCBiPzogc3RyaW5nW10pIHtcbiAgaWYgKCFhICYmICFiKSByZXR1cm4gdHJ1ZVxuICBpZiAoIWEgfHwgIWIpIHJldHVybiBmYWxzZVxuICBpZiAoYS5sZW5ndGggIT09IGIubGVuZ3RoKSByZXR1cm4gZmFsc2VcbiAgY29uc3Qgc29ydGVkQSA9IFsuLi5hXS5zb3J0KClcbiAgY29uc3Qgc29ydGVkQiA9IFsuLi5iXS5zb3J0KClcbiAgcmV0dXJuIHNvcnRlZEEuZXZlcnkoKHZhbHVlLCBpbmRleCkgPT4gdmFsdWUgPT09IHNvcnRlZEJbaW5kZXhdKVxufVxuIl0sIm5hbWVzIjpbInJlY29yZEF1dGhFdmVudCIsInN1cGFiYXNlIiwiZW5zdXJlT3JnYW5pemF0aW9uIiwiZXh0ZXJuYWxJZCIsIm5hbWUiLCJFcnJvciIsImRhdGEiLCJleGlzdGluZyIsImVycm9yIiwic2VsZWN0RXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJtYXliZVNpbmdsZSIsIm1lc3NhZ2UiLCJ1cGRhdGVkIiwidXBkYXRlRXJyb3IiLCJ1cGRhdGUiLCJpZCIsInNpbmdsZSIsImluc2VydGVkIiwiaW5zZXJ0RXJyb3IiLCJpbnNlcnQiLCJleHRlcm5hbF9yZWYiLCJlbnN1cmVVc2VyIiwicGFyYW1zIiwiYXV0aDBVc2VySWQiLCJlbWFpbCIsImRpc3BsYXlOYW1lIiwidXBzZXJ0IiwiYXV0aDBfdXNlcl9pZCIsImRpc3BsYXlfbmFtZSIsIm9uQ29uZmxpY3QiLCJlbnN1cmVNZW1iZXJzaGlwIiwibWF0Y2giLCJ1c2VyX2lkIiwidXNlcklkIiwib3JnYW5pemF0aW9uX2lkIiwib3JnYW5pemF0aW9uSWQiLCJBcnJheSIsImlzQXJyYXkiLCJyb2xlcyIsImFycmF5c0VxdWFsIiwiYWN0b3JVc2VySWQiLCJvcmdJZCIsImV2ZW50VHlwZSIsIm1ldGFkYXRhIiwidGFyZ2V0VXNlcklkIiwicHJldmlvdXNSb2xlcyIsIm5leHRSb2xlcyIsImdldE1lbWJlcnNoaXAiLCJnZXRVc2VyQnlBdXRoUHJvdmlkZXIiLCJyZWNvcmRVc2VyU2Vzc2lvbiIsInNlc3Npb25JZCIsImlwX2FkZHJlc3MiLCJpcEFkZHJlc3MiLCJnZW9fY291bnRyeSIsImdlb0NvdW50cnkiLCJ1c2VyX2FnZW50IiwidXNlckFnZW50IiwiZXhwaXJlc19hdCIsImV4cGlyZXNBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImxhc3Rfc2Vlbl9hdCIsInRvdWNoVXNlclNlc3Npb24iLCJlbmRVc2VyU2Vzc2lvbiIsImVuZGVkX2F0IiwiYSIsImIiLCJsZW5ndGgiLCJzb3J0ZWRBIiwic29ydCIsInNvcnRlZEIiLCJldmVyeSIsInZhbHVlIiwiaW5kZXgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth/store.ts\n");

/***/ }),

/***/ "(rsc)/./lib/db/supabase.ts":
/*!****************************!*\
  !*** ./lib/db/supabase.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabase: () => (/* binding */ supabase)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabaseUrl = process.env.SUPABASE_URL;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nif (!supabaseUrl || !supabaseServiceRoleKey) {\n    throw new Error(\"Missing Supabase configuration. Ensure SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY are set in the environment.\");\n}\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceRoleKey, {\n    auth: {\n        persistSession: false\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvZGIvc3VwYWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBb0Q7QUFFcEQsTUFBTUMsY0FBY0MsUUFBUUMsR0FBRyxDQUFDQyxZQUFZO0FBQzVDLE1BQU1DLHlCQUF5QkgsUUFBUUMsR0FBRyxDQUFDRyx5QkFBeUI7QUFFcEUsSUFBSSxDQUFDTCxlQUFlLENBQUNJLHdCQUF3QjtJQUMzQyxNQUFNLElBQUlFLE1BQ1I7QUFFSjtBQUVPLE1BQU1DLFdBQVdSLG1FQUFZQSxDQUFDQyxhQUFhSSx3QkFBd0I7SUFDeEVJLE1BQU07UUFBRUMsZ0JBQWdCO0lBQU07QUFDaEMsR0FBRSIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9saWIvZGIvc3VwYWJhc2UudHM/MThiMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCJcblxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9VUkxcbmNvbnN0IHN1cGFiYXNlU2VydmljZVJvbGVLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZXG5cbmlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlU2VydmljZVJvbGVLZXkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKFxuICAgIFwiTWlzc2luZyBTdXBhYmFzZSBjb25maWd1cmF0aW9uLiBFbnN1cmUgU1VQQUJBU0VfVVJMIGFuZCBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIGFyZSBzZXQgaW4gdGhlIGVudmlyb25tZW50LlwiXG4gIClcbn1cblxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VSb2xlS2V5LCB7XG4gIGF1dGg6IHsgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0sXG59KVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIlNVUEFCQVNFX1VSTCIsInN1cGFiYXNlU2VydmljZVJvbGVLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiRXJyb3IiLCJzdXBhYmFzZSIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/db/supabase.ts\n");

/***/ }),

/***/ "(rsc)/./lib/rbac.ts":
/*!*********************!*\
  !*** ./lib/rbac.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DEFAULT_ROLE: () => (/* binding */ DEFAULT_ROLE),\n/* harmony export */   ROLE_PERMISSIONS: () => (/* binding */ ROLE_PERMISSIONS),\n/* harmony export */   collectUserPermissions: () => (/* binding */ collectUserPermissions),\n/* harmony export */   hasPermission: () => (/* binding */ hasPermission),\n/* harmony export */   requirePermission: () => (/* binding */ requirePermission)\n/* harmony export */ });\nconst DEFAULT_ROLE = \"designer\";\nconst ROLE_PERMISSIONS = {\n    admin: [\n        \"pipelines:read\",\n        \"pipelines:write\",\n        \"pipelines:approve\",\n        \"audit:read\",\n        \"audit:write\",\n        \"agents:publish\",\n        \"org:manage\"\n    ],\n    analyst: [\n        \"pipelines:read\",\n        \"pipelines:write\",\n        \"pipelines:approve\",\n        \"audit:write\"\n    ],\n    designer: [\n        \"pipelines:read\",\n        \"pipelines:write\"\n    ],\n    compliance: [\n        \"pipelines:read\",\n        \"audit:read\"\n    ],\n    manufacturer: [\n        \"pipelines:read\",\n        \"pipelines:approve\"\n    ],\n    freelancer: [\n        \"pipelines:read\"\n    ]\n};\nfunction collectUserPermissions(roles = []) {\n    const permissions = new Set();\n    roles.forEach((role)=>{\n        const rolePermissions = ROLE_PERMISSIONS[role];\n        rolePermissions?.forEach((permission)=>permissions.add(permission));\n    });\n    return permissions;\n}\nfunction hasPermission(roles, permission) {\n    return collectUserPermissions(roles).has(permission);\n}\nfunction requirePermission(roles, permission) {\n    if (!hasPermission(roles, permission)) {\n        throw new Error(`Missing permission: ${permission}`);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcmJhYy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFPLE1BQU1BLGVBQWUsV0FBVTtBQUUvQixNQUFNQyxtQkFBNkM7SUFDeERDLE9BQU87UUFDTDtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtLQUNEO0lBQ0RDLFNBQVM7UUFBQztRQUFrQjtRQUFtQjtRQUFxQjtLQUFjO0lBQ2xGQyxVQUFVO1FBQUM7UUFBa0I7S0FBa0I7SUFDL0NDLFlBQVk7UUFBQztRQUFrQjtLQUFhO0lBQzVDQyxjQUFjO1FBQUM7UUFBa0I7S0FBb0I7SUFDckRDLFlBQVk7UUFBQztLQUFpQjtBQUNoQyxFQUFDO0FBRU0sU0FBU0MsdUJBQXVCQyxRQUFrQixFQUFFO0lBQ3pELE1BQU1DLGNBQWMsSUFBSUM7SUFDeEJGLE1BQU1HLE9BQU8sQ0FBQyxDQUFDQztRQUNiLE1BQU1DLGtCQUFrQmIsZ0JBQWdCLENBQUNZLEtBQUs7UUFDOUNDLGlCQUFpQkYsUUFBUSxDQUFDRyxhQUFlTCxZQUFZTSxHQUFHLENBQUNEO0lBQzNEO0lBQ0EsT0FBT0w7QUFDVDtBQUVPLFNBQVNPLGNBQWNSLEtBQWUsRUFBRU0sVUFBa0I7SUFDL0QsT0FBT1AsdUJBQXVCQyxPQUFPUyxHQUFHLENBQUNIO0FBQzNDO0FBRU8sU0FBU0ksa0JBQWtCVixLQUFlLEVBQUVNLFVBQWtCO0lBQ25FLElBQUksQ0FBQ0UsY0FBY1IsT0FBT00sYUFBYTtRQUNyQyxNQUFNLElBQUlLLE1BQU0sQ0FBQyxvQkFBb0IsRUFBRUwsV0FBVyxDQUFDO0lBQ3JEO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teS12MC1wcm9qZWN0Ly4vbGliL3JiYWMudHM/YzYxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgREVGQVVMVF9ST0xFID0gXCJkZXNpZ25lclwiXG5cbmV4cG9ydCBjb25zdCBST0xFX1BFUk1JU1NJT05TOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4gPSB7XG4gIGFkbWluOiBbXG4gICAgXCJwaXBlbGluZXM6cmVhZFwiLFxuICAgIFwicGlwZWxpbmVzOndyaXRlXCIsXG4gICAgXCJwaXBlbGluZXM6YXBwcm92ZVwiLFxuICAgIFwiYXVkaXQ6cmVhZFwiLFxuICAgIFwiYXVkaXQ6d3JpdGVcIixcbiAgICBcImFnZW50czpwdWJsaXNoXCIsXG4gICAgXCJvcmc6bWFuYWdlXCIsXG4gIF0sXG4gIGFuYWx5c3Q6IFtcInBpcGVsaW5lczpyZWFkXCIsIFwicGlwZWxpbmVzOndyaXRlXCIsIFwicGlwZWxpbmVzOmFwcHJvdmVcIiwgXCJhdWRpdDp3cml0ZVwiXSxcbiAgZGVzaWduZXI6IFtcInBpcGVsaW5lczpyZWFkXCIsIFwicGlwZWxpbmVzOndyaXRlXCJdLFxuICBjb21wbGlhbmNlOiBbXCJwaXBlbGluZXM6cmVhZFwiLCBcImF1ZGl0OnJlYWRcIl0sXG4gIG1hbnVmYWN0dXJlcjogW1wicGlwZWxpbmVzOnJlYWRcIiwgXCJwaXBlbGluZXM6YXBwcm92ZVwiXSxcbiAgZnJlZWxhbmNlcjogW1wicGlwZWxpbmVzOnJlYWRcIl0sXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb2xsZWN0VXNlclBlcm1pc3Npb25zKHJvbGVzOiBzdHJpbmdbXSA9IFtdKSB7XG4gIGNvbnN0IHBlcm1pc3Npb25zID0gbmV3IFNldDxzdHJpbmc+KClcbiAgcm9sZXMuZm9yRWFjaCgocm9sZSkgPT4ge1xuICAgIGNvbnN0IHJvbGVQZXJtaXNzaW9ucyA9IFJPTEVfUEVSTUlTU0lPTlNbcm9sZV1cbiAgICByb2xlUGVybWlzc2lvbnM/LmZvckVhY2goKHBlcm1pc3Npb24pID0+IHBlcm1pc3Npb25zLmFkZChwZXJtaXNzaW9uKSlcbiAgfSlcbiAgcmV0dXJuIHBlcm1pc3Npb25zXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYXNQZXJtaXNzaW9uKHJvbGVzOiBzdHJpbmdbXSwgcGVybWlzc2lvbjogc3RyaW5nKSB7XG4gIHJldHVybiBjb2xsZWN0VXNlclBlcm1pc3Npb25zKHJvbGVzKS5oYXMocGVybWlzc2lvbilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlcXVpcmVQZXJtaXNzaW9uKHJvbGVzOiBzdHJpbmdbXSwgcGVybWlzc2lvbjogc3RyaW5nKSB7XG4gIGlmICghaGFzUGVybWlzc2lvbihyb2xlcywgcGVybWlzc2lvbikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE1pc3NpbmcgcGVybWlzc2lvbjogJHtwZXJtaXNzaW9ufWApXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJERUZBVUxUX1JPTEUiLCJST0xFX1BFUk1JU1NJT05TIiwiYWRtaW4iLCJhbmFseXN0IiwiZGVzaWduZXIiLCJjb21wbGlhbmNlIiwibWFudWZhY3R1cmVyIiwiZnJlZWxhbmNlciIsImNvbGxlY3RVc2VyUGVybWlzc2lvbnMiLCJyb2xlcyIsInBlcm1pc3Npb25zIiwiU2V0IiwiZm9yRWFjaCIsInJvbGUiLCJyb2xlUGVybWlzc2lvbnMiLCJwZXJtaXNzaW9uIiwiYWRkIiwiaGFzUGVybWlzc2lvbiIsImhhcyIsInJlcXVpcmVQZXJtaXNzaW9uIiwiRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/rbac.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/@babel","vendor-chunks/jose","vendor-chunks/@supabase","vendor-chunks/openid-client","vendor-chunks/uuid","vendor-chunks/oauth","vendor-chunks/@panva","vendor-chunks/request-ip","vendor-chunks/preact-render-to-string","vendor-chunks/preact","vendor-chunks/oidc-token-hash","vendor-chunks/cookie"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&page=%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2F%5B...nextauth%5D%2Froute.ts&appDir=%2FUsers%2Fgverma%2FDesktop%2FAARAIK%20LLC%2FAbode_AI%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgverma%2FDesktop%2FAARAIK%20LLC%2FAbode_AI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();